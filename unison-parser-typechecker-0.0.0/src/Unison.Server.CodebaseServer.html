<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Server.CodebaseServer</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newEmptyMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">putMVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readMVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">race</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ErrorCall</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.URI.Encode</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">URI</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C8</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lazy</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.UTF8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BLU</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Info</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">License</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">URL</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.OpenApi.Lens</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OpenApi</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Media</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(//)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(/:)</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.NanoID</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">customNanoID</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultAlphabet</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unNanoID</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Types.Status</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ok200</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">responseLBS</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Port</span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-identifier">defaultSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-identifier">runSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-identifier">setBeforeMainLoop</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-identifier">setHost</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-identifier">setPort</span></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-identifier">withApplicationSettings</span></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MimeRender</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-identifier">serve</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Accept</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-identifier">Capture</span></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-identifier">CaptureAll</span></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="hs-identifier">Get</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-identifier">JSON</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-identifier">Raw</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-operator">(:&gt;)</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Docs</span></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DocIntro</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-identifier">ToSample</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="hs-identifier">docsWithIntros</span></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-identifier">markdown</span></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-identifier">singleSample</span></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.OpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasOpenApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toOpenApi</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-identifier">Handler</span></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier">Server</span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-identifier">ServerError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="hs-identifier">Tagged</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tagged</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-identifier">err401</span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="hs-identifier">err404</span></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Servant.Server.StaticFiles</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">serveDirectoryWebApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">canonicalizePath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">doesFileExist</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getExecutablePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random.MWC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createSystemRandom</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.html"><span class="hs-identifier">Unison.Codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier">Codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Runtime.html"><span class="hs-identifier">Unison.Codebase.Runtime</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rt</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html"><span class="hs-identifier">Unison.Parser.Ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier">Ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html"><span class="hs-identifier">Unison.Server.Endpoints.FuzzyFind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier">FuzzyFindAPI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier">serveFuzzyFind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html"><span class="hs-identifier">Unison.Server.Endpoints.GetDefinitions</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier">DefinitionsAPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier">serveDefinitions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceDetails.html"><span class="hs-identifier">Unison.Server.Endpoints.NamespaceDetails</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceDetails</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceListing.html"><span class="hs-identifier">Unison.Server.Endpoints.NamespaceListing</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceListing</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Server.Types.html"><span class="hs-identifier">Unison.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier">mungeString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- HTML content type</span><span>
</span><span id="line-94"></span><span class="hs-keyword">data</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HTML"><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-var">HTML</span></a></span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">newtype</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RawHtml"><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unRaw"><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#unRaw"><span class="hs-identifier hs-var hs-var">unRaw</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681830267"><span class="annot"><span class="hs-identifier hs-type">Accept</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621681830265"><span class="annot"><span class="annottext">contentType :: Proxy HTML -&gt; MediaType
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">contentType</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; MediaType
</span><span class="hs-operator hs-var">//</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;html&quot;</span></span><span> </span><span class="annot"><span class="annottext">MediaType -&gt; (ByteString, ByteString) -&gt; MediaType
</span><span class="hs-operator hs-var">/:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;charset&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;utf-8&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MimeRender</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621681830260"><span class="annot"><span class="annottext">mimeRender :: Proxy HTML -&gt; RawHtml -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mimeRender</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy HTML
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RawHtml -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#unRaw"><span class="hs-identifier hs-var hs-var">unRaw</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">type</span><span> </span><span id="OpenApiJSON"><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-var">OpenApiJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;openapi.json&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">type</span><span> </span><span id="DocAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#DocAPI"><span class="hs-identifier hs-var">DocAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#OpenApiJSON"><span class="hs-identifier hs-type">OpenApiJSON</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">type</span><span> </span><span id="UnisonAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-var">UnisonAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceListing.html#NamespaceListingAPI"><span class="hs-identifier hs-type">NamespaceListing.NamespaceListingAPI</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.NamespaceDetails.html#NamespaceDetailsAPI"><span class="hs-identifier hs-type">NamespaceDetails.NamespaceDetailsAPI</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.GetDefinitions.html#DefinitionsAPI"><span class="hs-identifier hs-type">DefinitionsAPI</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.Endpoints.FuzzyFind.html#FuzzyFindAPI"><span class="hs-identifier hs-type">FuzzyFindAPI</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">type</span><span> </span><span id="WebUI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-var">WebUI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CaptureAll</span></span><span> </span><span class="annot"><span class="hs-string">&quot;route&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Get</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#HTML"><span class="hs-identifier hs-type">HTML</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">type</span><span> </span><span id="ServerAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-var">ServerAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;ui&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;api&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DocAPI"><span class="hs-identifier hs-type">DocAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">type</span><span> </span><span id="AuthedServerAPI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#AuthedServerAPI"><span class="hs-identifier hs-var">AuthedServerAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;static&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Raw</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Capture</span></span><span> </span><span class="annot"><span class="hs-string">&quot;token&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ServerAPI"><span class="hs-identifier hs-type">ServerAPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToSample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621681830252"><span class="annot"><span class="annottext">toSamples :: Proxy Char -&gt; [(Text, Char)]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toSamples</span></span></span><span> </span><span class="annot"><span class="annottext">Proxy Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Text, Char)]
forall a. a -&gt; [(Text, a)]
</span><span class="hs-identifier hs-var">singleSample</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- BaseUrl and helpers</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">data</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BaseUrl"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="urlHost"><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#urlHost"><span class="hs-identifier hs-var hs-var">urlHost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>    </span><span id="urlToken"><span class="annot"><span class="annottext">BaseUrl -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#urlToken"><span class="hs-identifier hs-var hs-var">urlToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span id="urlPort"><span class="annot"><span class="annottext">BaseUrl -&gt; Port
</span><a href="Unison.Server.CodebaseServer.html#urlPort"><span class="hs-identifier hs-var hs-var">urlPort</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Port</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">data</span><span> </span><span id="BaseUrlPath"><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrlPath"><span class="hs-identifier hs-var">BaseUrlPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UI"><span class="annot"><a href="Unison.Server.CodebaseServer.html#UI"><span class="hs-identifier hs-var">UI</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Api"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681830240"><span id="local-6989586621681830243"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>  </span><span id="local-6989586621681830238"><span class="annot"><span class="annottext">show :: BaseUrl -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span id="local-6989586621681830236"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830236"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#urlHost"><span class="hs-identifier hs-var hs-var">urlHost</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830236"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; Port
</span><a href="Unison.Server.CodebaseServer.html#urlPort"><span class="hs-identifier hs-var hs-var">urlPort</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830236"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">URI.encode</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; (BaseUrl -&gt; String) -&gt; BaseUrl -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; String)
-&gt; (BaseUrl -&gt; ByteString) -&gt; BaseUrl -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; ByteString
</span><a href="Unison.Server.CodebaseServer.html#urlToken"><span class="hs-identifier hs-var hs-var">urlToken</span></a></span><span> </span><span class="annot"><span class="annottext">(BaseUrl -&gt; String) -&gt; BaseUrl -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830236"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-type">urlFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrlPath"><span class="hs-identifier hs-type">BaseUrlPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-138"></span><span id="urlFor"><span class="annot"><span class="annottext">urlFor :: BaseUrlPath -&gt; BaseUrl -&gt; String
</span><a href="Unison.Server.CodebaseServer.html#urlFor"><span class="hs-identifier hs-var hs-var">urlFor</span></a></span></span><span> </span><span id="local-6989586621681830232"><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="#local-6989586621681830232"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621681830231"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830231"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="#local-6989586621681830232"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="Unison.Server.CodebaseServer.html#UI"><span class="hs-identifier hs-var">UI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830231"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/ui&quot;</span></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">BaseUrlPath
</span><a href="Unison.Server.CodebaseServer.html#Api"><span class="hs-identifier hs-var">Api</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621681830231"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/api&quot;</span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-type">handleAuth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span id="handleAuth"><span class="annot"><span class="annottext">handleAuth :: ByteString -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var hs-var">handleAuth</span></a></span></span><span> </span><span id="local-6989586621681830229"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830229"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span id="local-6989586621681830228"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830228"><span class="hs-identifier hs-var">gotToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">Text.decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830229"><span class="hs-identifier hs-var">expectedToken</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830228"><span class="hs-identifier hs-var">gotToken</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; Handler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Handler ()
forall (m :: * -&gt; *) a.
MonadError ServerError m =&gt;
ByteString -&gt; m a
</span><a href="#local-6989586621681830226"><span class="hs-identifier hs-var">throw401</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;Authentication token missing or incorrect.&quot;</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681830226"><span class="annot"><span class="annottext">throw401 :: ByteString -&gt; m a
</span><a href="#local-6989586621681830226"><span class="hs-identifier hs-var hs-var">throw401</span></a></span></span><span> </span><span id="local-6989586621681830225"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830225"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; m a) -&gt; ServerError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err401</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830225"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-type">openAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenApi</span></span><span>
</span><span id="line-152"></span><span id="openAPI"><span class="annot"><span class="annottext">openAPI :: OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var hs-var">openAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI -&gt; OpenApi
forall k (api :: k). HasOpenApi api =&gt; Proxy api -&gt; OpenApi
</span><span class="hs-identifier hs-var">toOpenApi</span></span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; (OpenApi -&gt; OpenApi) -&gt; OpenApi
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Info -&gt; Identity Info) -&gt; OpenApi -&gt; Identity OpenApi
forall s a. HasInfo s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">OpenApi.info</span></span><span> </span><span class="annot"><span class="annottext">((Info -&gt; Identity Info) -&gt; OpenApi -&gt; Identity OpenApi)
-&gt; Info -&gt; OpenApi -&gt; OpenApi
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-type">infoObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-155"></span><span id="infoObject"><span class="annot"><span class="annottext">infoObject :: Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var hs-var">infoObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Info
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_infoTitle :: Text
</span><span class="hs-identifier hs-var">_infoTitle</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unison Codebase Manager API&quot;</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_infoDescription :: Maybe Text
</span><span class="hs-identifier hs-var">_infoDescription</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Provides operations for querying and manipulating a Unison codebase.&quot;</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_infoLicense :: Maybe License
</span><span class="hs-identifier hs-var">_infoLicense</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">License -&gt; Maybe License
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(License -&gt; Maybe License)
-&gt; (URL -&gt; License) -&gt; URL -&gt; Maybe License
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe URL -&gt; License
</span><span class="hs-identifier hs-var">License</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;MIT&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe URL -&gt; License) -&gt; (URL -&gt; Maybe URL) -&gt; URL -&gt; License
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">URL -&gt; Maybe URL
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(URL -&gt; Maybe License) -&gt; URL -&gt; Maybe License
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; URL
</span><span class="hs-identifier hs-var">URL</span></span><span>
</span><span id="line-160"></span><span>                         </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;https://github.com/unisonweb/unison/blob/trunk/LICENSE&quot;</span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_infoVersion :: Text
</span><span class="hs-identifier hs-var">_infoVersion</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;1.0&quot;</span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-type">docsBS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lazy.ByteString</span></span><span>
</span><span id="line-165"></span><span id="docsBS"><span class="annot"><span class="annottext">docsBS :: ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var hs-var">docsBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="Unison.Server.Types.html#mungeString"><span class="hs-identifier hs-var">mungeString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ByteString) -&gt; (API -&gt; String) -&gt; API -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">API -&gt; String
</span><span class="hs-identifier hs-var">markdown</span></span><span> </span><span class="annot"><span class="annottext">(API -&gt; ByteString) -&gt; API -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[DocIntro] -&gt; Proxy UnisonAPI -&gt; API
forall k (api :: k). HasDocs api =&gt; [DocIntro] -&gt; Proxy api -&gt; API
</span><span class="hs-identifier hs-var">docsWithIntros</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DocIntro
</span><a href="#local-6989586621681830211"><span class="hs-identifier hs-var">intro</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var">api</span></a></span><span>
</span><span id="line-166"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621681830211"><span class="annot"><span class="annottext">intro :: DocIntro
</span><a href="#local-6989586621681830211"><span class="hs-identifier hs-var hs-var">intro</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; DocIntro
</span><span class="hs-identifier hs-var">DocIntro</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Text
</span><span class="hs-identifier hs-var hs-var">_infoTitle</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; [String]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Maybe Text -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Maybe Text
</span><span class="hs-identifier hs-var hs-var">_infoDescription</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="Unison.Server.CodebaseServer.html#infoObject"><span class="hs-identifier hs-var">infoObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#docAPI"><span class="hs-identifier hs-type">docAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#DocAPI"><span class="hs-identifier hs-type">DocAPI</span></a></span><span>
</span><span id="line-171"></span><span id="docAPI"><span class="annot"><span class="annottext">docAPI :: Proxy DocAPI
</span><a href="Unison.Server.CodebaseServer.html#docAPI"><span class="hs-identifier hs-var hs-var">docAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy DocAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-type">api</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#UnisonAPI"><span class="hs-identifier hs-type">UnisonAPI</span></a></span><span>
</span><span id="line-174"></span><span id="api"><span class="annot"><span class="annottext">api :: Proxy UnisonAPI
</span><a href="Unison.Server.CodebaseServer.html#api"><span class="hs-identifier hs-var hs-var">api</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy UnisonAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-type">serverAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AuthedServerAPI"><span class="hs-identifier hs-type">AuthedServerAPI</span></a></span><span>
</span><span id="line-177"></span><span id="serverAPI"><span class="annot"><span class="annottext">serverAPI :: Proxy AuthedServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var hs-var">serverAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy AuthedServerAPI
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span id="local-6989586621681830367"><span class="annot"><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-type">app</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621681830367"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Runtime.html#Runtime"><span class="hs-identifier hs-type">Rt.Runtime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830367"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681830367"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span></span><span>
</span><span id="line-186"></span><span id="app"><span class="annot"><span class="annottext">app :: Runtime v
-&gt; Codebase IO v Ann -&gt; String -&gt; ByteString -&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621681830202"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830202"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621681830201"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830201"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621681830200"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830200"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621681830199"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830199"><span class="hs-identifier hs-var">expectedToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">Proxy AuthedServerAPI -&gt; Server AuthedServerAPI -&gt; Application
forall api.
HasServer api '[] =&gt;
Proxy api -&gt; Server api -&gt; Application
</span><span class="hs-identifier hs-var">serve</span></span><span> </span><span class="annot"><span class="annottext">Proxy AuthedServerAPI
</span><a href="Unison.Server.CodebaseServer.html#serverAPI"><span class="hs-identifier hs-var">serverAPI</span></a></span><span> </span><span class="annot"><span class="annottext">(Server AuthedServerAPI -&gt; Application)
-&gt; Server AuthedServerAPI -&gt; Application
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Runtime v
-&gt; Codebase IO v Ann
-&gt; String
-&gt; ByteString
-&gt; Server AuthedServerAPI
forall v.
Var v =&gt;
Runtime v
-&gt; Codebase IO v Ann
-&gt; String
-&gt; ByteString
-&gt; Server AuthedServerAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var">server</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830202"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830201"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830200"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830199"><span class="hs-identifier hs-var">expectedToken</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- The Token is used to help prevent multiple users on a machine gain access to</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- each others codebases.</span><span>
</span><span id="line-191"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-type">genToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span>
</span><span id="line-192"></span><span id="genToken"><span class="annot"><span class="annottext">genToken :: IO ByteString
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var hs-var">genToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621681830196"><span class="annot"><span class="annottext">Gen RealWorld
</span><a href="#local-6989586621681830196"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Gen RealWorld)
IO GenIO
</span><span class="hs-identifier hs-var">createSystemRandom</span></span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621681830195"><span class="annot"><span class="annottext">NanoID
</span><a href="#local-6989586621681830195"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Alphabet -&gt; Length -&gt; GenIO -&gt; IO NanoID
</span><span class="hs-identifier hs-var">customNanoID</span></span><span> </span><span class="annot"><span class="annottext">Alphabet
</span><span class="hs-identifier hs-var">defaultAlphabet</span></span><span> </span><span class="annot"><span class="annottext">Length
</span><span class="hs-number">16</span></span><span> </span><span class="annot"><span class="annottext">Gen RealWorld
GenIO
</span><a href="#local-6989586621681830196"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">NanoID -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">unNanoID</span></span><span> </span><span class="annot"><span class="annottext">NanoID
</span><a href="#local-6989586621681830195"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-keyword">data</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span> </span><span id="local-6989586621681830384"><span class="annot"><a href="#local-6989586621681830384"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Waiter"><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-var">Waiter</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-199"></span><span>    </span><span id="notify"><span class="annot"><span class="annottext">Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#notify"><span class="hs-identifier hs-var hs-var">notify</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681830384"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-200"></span><span>    </span><span id="waitFor"><span class="annot"><span class="annottext">Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#waitFor"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681830384"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span id="local-6989586621681830365"><span class="annot"><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-type">mkWaiter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830365"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-204"></span><span id="mkWaiter"><span class="annot"><span class="annottext">mkWaiter :: IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var hs-var">mkWaiter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621681830190"><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621681830190"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar a)
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">Waiter :: forall a. (a -&gt; IO ()) -&gt; IO a -&gt; Waiter a
</span><a href="Unison.Server.CodebaseServer.html#Waiter"><span class="hs-identifier hs-type">Waiter</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">notify :: a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#notify"><span class="hs-identifier hs-var">notify</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; a -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621681830190"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">waitFor :: IO a
</span><a href="Unison.Server.CodebaseServer.html#waitFor"><span class="hs-identifier hs-var">waitFor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar a -&gt; IO a
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar a
</span><a href="#local-6989586621681830190"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-type">ucmUIVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-212"></span><span id="ucmUIVar"><span class="annot"><span class="annottext">ucmUIVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var hs-var">ucmUIVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_WEB_UI&quot;</span></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-type">ucmPortVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-215"></span><span id="ucmPortVar"><span class="annot"><span class="annottext">ucmPortVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmPortVar"><span class="hs-identifier hs-var hs-var">ucmPortVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_PORT&quot;</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-type">ucmHostVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-218"></span><span id="ucmHostVar"><span class="annot"><span class="annottext">ucmHostVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmHostVar"><span class="hs-identifier hs-var hs-var">ucmHostVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_HOST&quot;</span></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-type">ucmTokenVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-221"></span><span id="ucmTokenVar"><span class="annot"><span class="annottext">ucmTokenVar :: String
</span><a href="Unison.Server.CodebaseServer.html#ucmTokenVar"><span class="hs-identifier hs-var hs-var">ucmTokenVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UCM_TOKEN&quot;</span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">data</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CodebaseServerOpts"><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-var">CodebaseServerOpts</span></a></span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="token"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#token"><span class="hs-identifier hs-var hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="host"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#host"><span class="hs-identifier hs-var hs-var">host</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="port"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#port"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="codebaseUIPath"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#codebaseUIPath"><span class="hs-identifier hs-var hs-var">codebaseUIPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830175"><span id="local-6989586621681830177"><span id="local-6989586621681830179"><span class="annot"><span class="annottext">Port -&gt; CodebaseServerOpts -&gt; ShowS
[CodebaseServerOpts] -&gt; ShowS
CodebaseServerOpts -&gt; String
(Port -&gt; CodebaseServerOpts -&gt; ShowS)
-&gt; (CodebaseServerOpts -&gt; String)
-&gt; ([CodebaseServerOpts] -&gt; ShowS)
-&gt; Show CodebaseServerOpts
forall a.
(Port -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CodebaseServerOpts] -&gt; ShowS
$cshowList :: [CodebaseServerOpts] -&gt; ShowS
show :: CodebaseServerOpts -&gt; String
$cshow :: CodebaseServerOpts -&gt; String
showsPrec :: Port -&gt; CodebaseServerOpts -&gt; ShowS
$cshowsPrec :: Port -&gt; CodebaseServerOpts -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830171"><span id="local-6989586621681830173"><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
(CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool)
-&gt; (CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool)
-&gt; Eq CodebaseServerOpts
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c/= :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
$c== :: CodebaseServerOpts -&gt; CodebaseServerOpts -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- The auth token required for accessing the server is passed to the function k</span><span>
</span><span id="line-231"></span><span id="local-6989586621681830169"><span class="annot"><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-type">startServer</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621681830169"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#CodebaseServerOpts"><span class="hs-identifier hs-type">CodebaseServerOpts</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Runtime.html#Runtime"><span class="hs-identifier hs-type">Rt.Runtime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830169"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681830169"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-238"></span><span id="startServer"><span class="annot"><span class="annottext">startServer :: CodebaseServerOpts
-&gt; Runtime v -&gt; Codebase IO v Ann -&gt; (BaseUrl -&gt; IO ()) -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#startServer"><span class="hs-identifier hs-var hs-var">startServer</span></a></span></span><span> </span><span id="local-6989586621681830167"><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621681830167"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621681830166"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830166"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621681830165"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830165"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621681830164"><span class="annot"><span class="annottext">BaseUrl -&gt; IO ()
</span><a href="#local-6989586621681830164"><span class="hs-identifier hs-var">onStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- the `canonicalizePath` resolves symlinks</span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621681830163"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830163"><span class="hs-identifier hs-var">exePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; IO String -&gt; IO String
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getExecutablePath</span></span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621681830161"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830161"><span class="hs-identifier hs-var">envUI</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><span class="hs-identifier hs-var">canonicalizePath</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">FilePath.takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830163"><span class="hs-identifier hs-var">exePath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ui&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#codebaseUIPath"><span class="hs-identifier hs-var hs-var">codebaseUIPath</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621681830167"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621681830158"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830158"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#token"><span class="hs-identifier hs-var hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621681830167"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681830157"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830157"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ByteString) -&gt; ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">C8.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830157"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="Unison.Server.CodebaseServer.html#genToken"><span class="hs-identifier hs-var">genToken</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830155"><span class="annot"><span class="annottext">baseUrl :: Port -&gt; BaseUrl
</span><a href="#local-6989586621681830155"><span class="hs-identifier hs-var hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; Port -&gt; BaseUrl
</span><a href="Unison.Server.CodebaseServer.html#BaseUrl"><span class="hs-identifier hs-var">BaseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;http://127.0.0.1&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830158"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830154"><span class="annot"><span class="annottext">settings :: Settings
</span><a href="#local-6989586621681830154"><span class="hs-identifier hs-var hs-var">settings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Settings
</span><span class="hs-identifier hs-var">defaultSettings</span></span><span>
</span><span id="line-247"></span><span>               </span><span class="annot"><span class="annottext">Settings -&gt; (Settings -&gt; Settings) -&gt; Settings
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Settings -&gt; Settings)
-&gt; (Port -&gt; Settings -&gt; Settings)
-&gt; Maybe Port
-&gt; Settings
-&gt; Settings
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setPort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#port"><span class="hs-identifier hs-var hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621681830167"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>               </span><span class="annot"><span class="annottext">Settings -&gt; (Settings -&gt; Settings) -&gt; Settings
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Settings -&gt; Settings)
-&gt; (String -&gt; Settings -&gt; Settings)
-&gt; Maybe String
-&gt; Settings
-&gt; Settings
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Settings
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostPreference -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setHost</span></span><span> </span><span class="annot"><span class="annottext">(HostPreference -&gt; Settings -&gt; Settings)
-&gt; (String -&gt; HostPreference) -&gt; String -&gt; Settings -&gt; Settings
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; HostPreference
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe String
</span><a href="Unison.Server.CodebaseServer.html#host"><span class="hs-identifier hs-var hs-var">host</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621681830167"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830151"><span class="annot"><span class="annottext">a :: Application
</span><a href="#local-6989586621681830151"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Runtime v
-&gt; Codebase IO v Ann -&gt; String -&gt; ByteString -&gt; Application
forall v.
Var v =&gt;
Runtime v
-&gt; Codebase IO v Ann -&gt; String -&gt; ByteString -&gt; Application
</span><a href="Unison.Server.CodebaseServer.html#app"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830166"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830165"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830161"><span class="hs-identifier hs-var">envUI</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830158"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts -&gt; Maybe Port
</span><a href="Unison.Server.CodebaseServer.html#port"><span class="hs-identifier hs-var hs-var">port</span></a></span><span> </span><span class="annot"><span class="annottext">CodebaseServerOpts
</span><a href="#local-6989586621681830167"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">Maybe Port
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; IO Application -&gt; (Port -&gt; IO ()) -&gt; IO ()
forall a. Settings -&gt; IO Application -&gt; (Port -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withApplicationSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621681830154"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Application -&gt; IO Application
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621681830151"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; IO ()
</span><a href="#local-6989586621681830164"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="annot"><span class="annottext">(BaseUrl -&gt; IO ()) -&gt; (Port -&gt; BaseUrl) -&gt; Port -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Port -&gt; BaseUrl
</span><a href="#local-6989586621681830155"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681830150"><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621681830150"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621681830149"><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621681830149"><span class="hs-identifier hs-var">started</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Waiter ())
forall a. IO (Waiter a)
</span><a href="Unison.Server.CodebaseServer.html#mkWaiter"><span class="hs-identifier hs-var">mkWaiter</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830148"><span class="annot"><span class="annottext">settings' :: Settings
</span><a href="#local-6989586621681830148"><span class="hs-identifier hs-var hs-var">settings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Settings -&gt; Settings
</span><span class="hs-identifier hs-var">setBeforeMainLoop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Waiter () -&gt; () -&gt; IO ()
forall a. Waiter a -&gt; a -&gt; IO ()
</span><a href="Unison.Server.CodebaseServer.html#notify"><span class="hs-identifier hs-var hs-var">notify</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621681830149"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621681830154"><span class="hs-identifier hs-var">settings</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span id="local-6989586621681830147"><span class="annot"><span class="annottext">Either () ()
</span><a href="#local-6989586621681830147"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO (Either () ())
forall a b. IO a -&gt; IO b -&gt; IO (Either a b)
</span><span class="hs-identifier hs-var">race</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; Application -&gt; IO ()
</span><span class="hs-identifier hs-var">runSettings</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621681830148"><span class="hs-identifier hs-var">settings'</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621681830151"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Waiter () -&gt; IO ()
forall a. Waiter a -&gt; IO a
</span><a href="Unison.Server.CodebaseServer.html#waitFor"><span class="hs-identifier hs-var hs-var">waitFor</span></a></span><span> </span><span class="annot"><span class="annottext">Waiter ()
</span><a href="#local-6989586621681830149"><span class="hs-identifier hs-var">started</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; IO ()
</span><a href="#local-6989586621681830164"><span class="hs-identifier hs-var">onStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Port -&gt; BaseUrl
</span><a href="#local-6989586621681830155"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Port
</span><a href="#local-6989586621681830150"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either () ()
</span><a href="#local-6989586621681830147"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(ErrorCall -&gt; IO ()) -&gt; ErrorCall -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><span class="hs-identifier hs-var">ErrorCall</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Server exited unexpectedly!&quot;</span></span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621681830145"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621681830145"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621681830145"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-type">serveIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-type">RawHtml</span></a></span><span>
</span><span id="line-262"></span><span id="serveIndex"><span class="annot"><span class="annottext">serveIndex :: String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var hs-var">serveIndex</span></a></span></span><span> </span><span id="local-6989586621681830143"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830143"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830142"><span class="annot"><span class="annottext">index :: String
</span><a href="#local-6989586621681830142"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830143"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-264"></span><span>  </span><span id="local-6989586621681830141"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830141"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; Handler Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; Handler Bool) -&gt; IO Bool -&gt; Handler Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">doesFileExist</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830142"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830141"><span class="hs-identifier hs-var">exists</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; RawHtml) -&gt; Handler ByteString -&gt; Handler RawHtml
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RawHtml
</span><a href="Unison.Server.CodebaseServer.html#RawHtml"><span class="hs-identifier hs-var">RawHtml</span></a></span><span> </span><span class="annot"><span class="annottext">(Handler ByteString -&gt; Handler RawHtml)
-&gt; (String -&gt; Handler ByteString) -&gt; String -&gt; Handler RawHtml
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; Handler ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; Handler ByteString)
-&gt; (String -&gt; IO ByteString) -&gt; String -&gt; Handler ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">Lazy.readFile</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Handler RawHtml) -&gt; String -&gt; Handler RawHtml
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830143"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;index.html&quot;</span></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Handler RawHtml
forall a. Handler a
</span><a href="#local-6989586621681830138"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-268"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621681830138"><span class="annot"><span class="annottext">fail :: Handler a
</span><a href="#local-6989586621681830138"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; Handler a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; Handler a) -&gt; ServerError -&gt; Handler a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err404</span></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">BLU.fromString</span></span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><span class="annottext">(String -&gt; ByteString) -&gt; String -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No codebase UI configured.&quot;</span></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Set the &quot;</span></span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Unison.Server.CodebaseServer.html#ucmUIVar"><span class="hs-identifier hs-var">ucmUIVar</span></a></span><span>
</span><span id="line-275"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; environment variable to the directory where the UI is installed.&quot;</span></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-type">serveUI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#WebUI"><span class="hs-identifier hs-type">WebUI</span></a></span><span>
</span><span id="line-279"></span><span id="serveUI"><span class="annot"><span class="annottext">serveUI :: Handler () -&gt; String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var hs-var">serveUI</span></a></span></span><span> </span><span id="local-6989586621681830135"><span class="annot"><span class="annottext">Handler ()
</span><a href="#local-6989586621681830135"><span class="hs-identifier hs-var">tryAuth</span></a></span></span><span> </span><span id="local-6989586621681830134"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830134"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handler ()
</span><a href="#local-6989586621681830135"><span class="hs-identifier hs-var">tryAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Handler () -&gt; Handler RawHtml -&gt; Handler RawHtml
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Handler RawHtml
</span><a href="Unison.Server.CodebaseServer.html#serveIndex"><span class="hs-identifier hs-var">serveIndex</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830134"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span id="local-6989586621681830397"><span class="annot"><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-type">server</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621681830397"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Runtime.html#Runtime"><span class="hs-identifier hs-type">Rt.Runtime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830397"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Type.html#Codebase"><span class="hs-identifier hs-type">Codebase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681830397"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Unison.Parser.Ann.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Strict.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="annot"><a href="Unison.Server.CodebaseServer.html#AuthedServerAPI"><span class="hs-identifier hs-type">AuthedServerAPI</span></a></span></span><span>
</span><span id="line-288"></span><span id="server"><span class="annot"><span class="annottext">server :: Runtime v
-&gt; Codebase IO v Ann
-&gt; String
-&gt; ByteString
-&gt; Server AuthedServerAPI
</span><a href="Unison.Server.CodebaseServer.html#server"><span class="hs-identifier hs-var hs-var">server</span></a></span></span><span> </span><span id="local-6989586621681830133"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830133"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621681830132"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830132"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621681830131"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830131"><span class="hs-identifier hs-var">uiPath</span></a></span></span><span> </span><span id="local-6989586621681830130"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830130"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; ServerT Raw Handler
forall (m :: * -&gt; *). String -&gt; ServerT Raw m
</span><span class="hs-identifier hs-var">serveDirectoryWebApp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830131"><span class="hs-identifier hs-var">uiPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">Tagged Handler Application
-&gt; (Text
    -&gt; ([Text] -&gt; Handler RawHtml)
       :&lt;|&gt; (((Maybe ShortBranchHash
               -&gt; Maybe Text
               -&gt; Maybe Text
               -&gt; Handler (APIHeaders NamespaceListing))
              :&lt;|&gt; ((Text
                     -&gt; Maybe ShortBranchHash
                     -&gt; Maybe Width
                     -&gt; Handler (APIHeaders NamespaceDetails))
                    :&lt;|&gt; ((Maybe ShortBranchHash
                           -&gt; Maybe Text
                           -&gt; [Text]
                           -&gt; Maybe Width
                           -&gt; Maybe Suffixify
                           -&gt; Handler (APIHeaders DefinitionDisplayResults))
                          :&lt;|&gt; (Maybe ShortBranchHash
                                -&gt; Maybe Text
                                -&gt; Maybe Port
                                -&gt; Maybe Width
                                -&gt; Maybe String
                                -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))))
             :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)))
-&gt; Tagged Handler Application
   :&lt;|&gt; (Text
         -&gt; ([Text] -&gt; Handler RawHtml)
            :&lt;|&gt; (((Maybe ShortBranchHash
                    -&gt; Maybe Text
                    -&gt; Maybe Text
                    -&gt; Handler (APIHeaders NamespaceListing))
                   :&lt;|&gt; ((Text
                          -&gt; Maybe ShortBranchHash
                          -&gt; Maybe Width
                          -&gt; Handler (APIHeaders NamespaceDetails))
                         :&lt;|&gt; ((Maybe ShortBranchHash
                                -&gt; Maybe Text
                                -&gt; [Text]
                                -&gt; Maybe Width
                                -&gt; Maybe Suffixify
                                -&gt; Handler (APIHeaders DefinitionDisplayResults))
                               :&lt;|&gt; (Maybe ShortBranchHash
                                     -&gt; Maybe Text
                                     -&gt; Maybe Port
                                     -&gt; Maybe Width
                                     -&gt; Maybe String
                                     -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))))
                  :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681830128"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830128"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>             </span><span class="annot"><span class="annottext">Handler () -&gt; String -&gt; Server WebUI
</span><a href="Unison.Server.CodebaseServer.html#serveUI"><span class="hs-identifier hs-var">serveUI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Handler ()
</span><a href="#local-6989586621681830127"><span class="hs-identifier hs-var">tryAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830128"><span class="hs-identifier hs-var">token</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830131"><span class="hs-identifier hs-var">uiPath</span></a></span><span>
</span><span id="line-292"></span><span>               </span><span class="annot"><span class="annottext">([Text] -&gt; Handler RawHtml)
-&gt; (((Maybe ShortBranchHash
      -&gt; Maybe Text
      -&gt; Maybe Text
      -&gt; Handler (APIHeaders NamespaceListing))
     :&lt;|&gt; ((Text
            -&gt; Maybe ShortBranchHash
            -&gt; Maybe Width
            -&gt; Handler (APIHeaders NamespaceDetails))
           :&lt;|&gt; ((Maybe ShortBranchHash
                  -&gt; Maybe Text
                  -&gt; [Text]
                  -&gt; Maybe Width
                  -&gt; Maybe Suffixify
                  -&gt; Handler (APIHeaders DefinitionDisplayResults))
                 :&lt;|&gt; (Maybe ShortBranchHash
                       -&gt; Maybe Text
                       -&gt; Maybe Port
                       -&gt; Maybe Width
                       -&gt; Maybe String
                       -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))))
    :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application))
-&gt; ([Text] -&gt; Handler RawHtml)
   :&lt;|&gt; (((Maybe ShortBranchHash
           -&gt; Maybe Text
           -&gt; Maybe Text
           -&gt; Handler (APIHeaders NamespaceListing))
          :&lt;|&gt; ((Text
                 -&gt; Maybe ShortBranchHash
                 -&gt; Maybe Width
                 -&gt; Handler (APIHeaders NamespaceDetails))
                :&lt;|&gt; ((Maybe ShortBranchHash
                       -&gt; Maybe Text
                       -&gt; [Text]
                       -&gt; Maybe Width
                       -&gt; Maybe Suffixify
                       -&gt; Handler (APIHeaders DefinitionDisplayResults))
                      :&lt;|&gt; (Maybe ShortBranchHash
                            -&gt; Maybe Text
                            -&gt; Maybe Port
                            -&gt; Maybe Width
                            -&gt; Maybe String
                            -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))))
         :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (Maybe ShortBranchHash
    -&gt; Maybe Text
    -&gt; Maybe Text
    -&gt; Handler (APIHeaders NamespaceListing))
   :&lt;|&gt; ((Text
          -&gt; Maybe ShortBranchHash
          -&gt; Maybe Width
          -&gt; Handler (APIHeaders NamespaceDetails))
         :&lt;|&gt; ((Maybe ShortBranchHash
                -&gt; Maybe Text
                -&gt; [Text]
                -&gt; Maybe Width
                -&gt; Maybe Suffixify
                -&gt; Handler (APIHeaders DefinitionDisplayResults))
               :&lt;|&gt; (Maybe ShortBranchHash
                     -&gt; Maybe Text
                     -&gt; Maybe Port
                     -&gt; Maybe Width
                     -&gt; Maybe String
                     -&gt; Handler (APIHeaders [(Alignment, FoundResult)]))))
</span><a href="#local-6989586621681830126"><span class="hs-identifier hs-var">unisonApi</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830128"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-293"></span><span>               </span><span class="annot"><span class="annottext">((Maybe ShortBranchHash
  -&gt; Maybe Text
  -&gt; Maybe Text
  -&gt; Handler (APIHeaders NamespaceListing))
 :&lt;|&gt; ((Text
        -&gt; Maybe ShortBranchHash
        -&gt; Maybe Width
        -&gt; Handler (APIHeaders NamespaceDetails))
       :&lt;|&gt; ((Maybe ShortBranchHash
              -&gt; Maybe Text
              -&gt; [Text]
              -&gt; Maybe Width
              -&gt; Maybe Suffixify
              -&gt; Handler (APIHeaders DefinitionDisplayResults))
             :&lt;|&gt; (Maybe ShortBranchHash
                   -&gt; Maybe Text
                   -&gt; Maybe Port
                   -&gt; Maybe Width
                   -&gt; Maybe String
                   -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))))
-&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)
-&gt; ((Maybe ShortBranchHash
     -&gt; Maybe Text
     -&gt; Maybe Text
     -&gt; Handler (APIHeaders NamespaceListing))
    :&lt;|&gt; ((Text
           -&gt; Maybe ShortBranchHash
           -&gt; Maybe Width
           -&gt; Handler (APIHeaders NamespaceDetails))
          :&lt;|&gt; ((Maybe ShortBranchHash
                 -&gt; Maybe Text
                 -&gt; [Text]
                 -&gt; Maybe Width
                 -&gt; Maybe Suffixify
                 -&gt; Handler (APIHeaders DefinitionDisplayResults))
                :&lt;|&gt; (Maybe ShortBranchHash
                      -&gt; Maybe Text
                      -&gt; Maybe Port
                      -&gt; Maybe Width
                      -&gt; Maybe String
                      -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))))
   :&lt;|&gt; (Handler OpenApi :&lt;|&gt; Tagged Handler Application)
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler OpenApi
</span><a href="#local-6989586621681830125"><span class="hs-identifier hs-var">serveOpenAPI</span></a></span><span>
</span><span id="line-294"></span><span>               </span><span class="annot"><span class="annottext">Handler OpenApi
-&gt; Tagged Handler Application
-&gt; Handler OpenApi :&lt;|&gt; Tagged Handler Application
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Application -&gt; Tagged Handler Application
forall k (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621681830124"><span class="hs-identifier hs-var">serveDocs</span></a></span><span>
</span><span id="line-295"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621681830124"><span class="annot"><span class="annottext">serveDocs :: Application
</span><a href="#local-6989586621681830124"><span class="hs-identifier hs-var hs-var">serveDocs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830123"><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621681830123"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621681830123"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Response -&gt; IO ResponseReceived)
-&gt; Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Status -&gt; ResponseHeaders -&gt; ByteString -&gt; Response
</span><span class="hs-identifier hs-var">responseLBS</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier hs-var">ok200</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(HeaderName, ByteString)
</span><a href="#local-6989586621681830122"><span class="hs-identifier hs-var">plain</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="Unison.Server.CodebaseServer.html#docsBS"><span class="hs-identifier hs-var">docsBS</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621681830125"><span class="annot"><span class="annottext">serveOpenAPI :: Handler OpenApi
</span><a href="#local-6989586621681830125"><span class="hs-identifier hs-var hs-var">serveOpenAPI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; Handler OpenApi
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="Unison.Server.CodebaseServer.html#openAPI"><span class="hs-identifier hs-var">openAPI</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621681830122"><span class="annot"><span class="annottext">plain :: (HeaderName, ByteString)
</span><a href="#local-6989586621681830122"><span class="hs-identifier hs-var hs-var">plain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621681830127"><span class="annot"><span class="annottext">tryAuth :: Text -&gt; Handler ()
</span><a href="#local-6989586621681830127"><span class="hs-identifier hs-var hs-var">tryAuth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text -&gt; Handler ()
</span><a href="Unison.Server.CodebaseServer.html#handleAuth"><span class="hs-identifier hs-var">handleAuth</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830130"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621681830126"><span class="annot"><span class="annottext">unisonApi :: Text
-&gt; (Maybe ShortBranchHash
    -&gt; Maybe Text
    -&gt; Maybe Text
    -&gt; Handler (APIHeaders NamespaceListing))
   :&lt;|&gt; ((Text
          -&gt; Maybe ShortBranchHash
          -&gt; Maybe Width
          -&gt; Handler (APIHeaders NamespaceDetails))
         :&lt;|&gt; ((Maybe ShortBranchHash
                -&gt; Maybe Text
                -&gt; [Text]
                -&gt; Maybe Width
                -&gt; Maybe Suffixify
                -&gt; Handler (APIHeaders DefinitionDisplayResults))
               :&lt;|&gt; (Maybe ShortBranchHash
                     -&gt; Maybe Text
                     -&gt; Maybe Port
                     -&gt; Maybe Width
                     -&gt; Maybe String
                     -&gt; Handler (APIHeaders [(Alignment, FoundResult)]))))
</span><a href="#local-6989586621681830126"><span class="hs-identifier hs-var hs-var">unisonApi</span></a></span></span><span> </span><span id="local-6989586621681830121"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830121"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>      </span><span class="annot"><span class="annottext">Handler ()
-&gt; Codebase IO v Ann
-&gt; Maybe ShortBranchHash
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; Handler (APIHeaders NamespaceListing)
forall v.
Var v =&gt;
Handler ()
-&gt; Codebase IO v Ann
-&gt; Maybe ShortBranchHash
-&gt; Maybe Text
-&gt; Maybe Text
-&gt; Handler (APIHeaders NamespaceListing)
</span><a href="Unison.Server.Endpoints.NamespaceListing.html#serve"><span class="hs-identifier hs-var">NamespaceListing.serve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Handler ()
</span><a href="#local-6989586621681830127"><span class="hs-identifier hs-var">tryAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830121"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830132"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">(Maybe ShortBranchHash
 -&gt; Maybe Text
 -&gt; Maybe Text
 -&gt; Handler (APIHeaders NamespaceListing))
-&gt; ((Text
     -&gt; Maybe ShortBranchHash
     -&gt; Maybe Width
     -&gt; Handler (APIHeaders NamespaceDetails))
    :&lt;|&gt; ((Maybe ShortBranchHash
           -&gt; Maybe Text
           -&gt; [Text]
           -&gt; Maybe Width
           -&gt; Maybe Suffixify
           -&gt; Handler (APIHeaders DefinitionDisplayResults))
          :&lt;|&gt; (Maybe ShortBranchHash
                -&gt; Maybe Text
                -&gt; Maybe Port
                -&gt; Maybe Width
                -&gt; Maybe String
                -&gt; Handler (APIHeaders [(Alignment, FoundResult)]))))
-&gt; (Maybe ShortBranchHash
    -&gt; Maybe Text
    -&gt; Maybe Text
    -&gt; Handler (APIHeaders NamespaceListing))
   :&lt;|&gt; ((Text
          -&gt; Maybe ShortBranchHash
          -&gt; Maybe Width
          -&gt; Handler (APIHeaders NamespaceDetails))
         :&lt;|&gt; ((Maybe ShortBranchHash
                -&gt; Maybe Text
                -&gt; [Text]
                -&gt; Maybe Width
                -&gt; Maybe Suffixify
                -&gt; Handler (APIHeaders DefinitionDisplayResults))
               :&lt;|&gt; (Maybe ShortBranchHash
                     -&gt; Maybe Text
                     -&gt; Maybe Port
                     -&gt; Maybe Width
                     -&gt; Maybe String
                     -&gt; Handler (APIHeaders [(Alignment, FoundResult)]))))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler ()
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Text
-&gt; Maybe ShortBranchHash
-&gt; Maybe Width
-&gt; Handler (APIHeaders NamespaceDetails)
forall v.
Var v =&gt;
Handler ()
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Text
-&gt; Maybe ShortBranchHash
-&gt; Maybe Width
-&gt; Handler (APIHeaders NamespaceDetails)
</span><a href="Unison.Server.Endpoints.NamespaceDetails.html#serve"><span class="hs-identifier hs-var">NamespaceDetails.serve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Handler ()
</span><a href="#local-6989586621681830127"><span class="hs-identifier hs-var">tryAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830121"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830133"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830132"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">(Text
 -&gt; Maybe ShortBranchHash
 -&gt; Maybe Width
 -&gt; Handler (APIHeaders NamespaceDetails))
-&gt; ((Maybe ShortBranchHash
     -&gt; Maybe Text
     -&gt; [Text]
     -&gt; Maybe Width
     -&gt; Maybe Suffixify
     -&gt; Handler (APIHeaders DefinitionDisplayResults))
    :&lt;|&gt; (Maybe ShortBranchHash
          -&gt; Maybe Text
          -&gt; Maybe Port
          -&gt; Maybe Width
          -&gt; Maybe String
          -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))
-&gt; (Text
    -&gt; Maybe ShortBranchHash
    -&gt; Maybe Width
    -&gt; Handler (APIHeaders NamespaceDetails))
   :&lt;|&gt; ((Maybe ShortBranchHash
          -&gt; Maybe Text
          -&gt; [Text]
          -&gt; Maybe Width
          -&gt; Maybe Suffixify
          -&gt; Handler (APIHeaders DefinitionDisplayResults))
         :&lt;|&gt; (Maybe ShortBranchHash
               -&gt; Maybe Text
               -&gt; Maybe Port
               -&gt; Maybe Width
               -&gt; Maybe String
               -&gt; Handler (APIHeaders [(Alignment, FoundResult)])))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler ()
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Maybe ShortBranchHash
-&gt; Maybe Text
-&gt; [Text]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Handler (APIHeaders DefinitionDisplayResults)
forall v.
Var v =&gt;
Handler ()
-&gt; Runtime v
-&gt; Codebase IO v Ann
-&gt; Maybe ShortBranchHash
-&gt; Maybe Text
-&gt; [Text]
-&gt; Maybe Width
-&gt; Maybe Suffixify
-&gt; Handler (APIHeaders DefinitionDisplayResults)
</span><a href="Unison.Server.Endpoints.GetDefinitions.html#serveDefinitions"><span class="hs-identifier hs-var">serveDefinitions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Handler ()
</span><a href="#local-6989586621681830127"><span class="hs-identifier hs-var">tryAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830121"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621681830133"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830132"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="annottext">(Maybe ShortBranchHash
 -&gt; Maybe Text
 -&gt; [Text]
 -&gt; Maybe Width
 -&gt; Maybe Suffixify
 -&gt; Handler (APIHeaders DefinitionDisplayResults))
-&gt; (Maybe ShortBranchHash
    -&gt; Maybe Text
    -&gt; Maybe Port
    -&gt; Maybe Width
    -&gt; Maybe String
    -&gt; Handler (APIHeaders [(Alignment, FoundResult)]))
-&gt; (Maybe ShortBranchHash
    -&gt; Maybe Text
    -&gt; [Text]
    -&gt; Maybe Width
    -&gt; Maybe Suffixify
    -&gt; Handler (APIHeaders DefinitionDisplayResults))
   :&lt;|&gt; (Maybe ShortBranchHash
         -&gt; Maybe Text
         -&gt; Maybe Port
         -&gt; Maybe Width
         -&gt; Maybe String
         -&gt; Handler (APIHeaders [(Alignment, FoundResult)]))
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Handler ()
-&gt; Codebase IO v Ann
-&gt; Maybe ShortBranchHash
-&gt; Maybe Text
-&gt; Maybe Port
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Handler (APIHeaders [(Alignment, FoundResult)])
forall v.
Var v =&gt;
Handler ()
-&gt; Codebase IO v Ann
-&gt; Maybe ShortBranchHash
-&gt; Maybe Text
-&gt; Maybe Port
-&gt; Maybe Width
-&gt; Maybe String
-&gt; Handler (APIHeaders [(Alignment, FoundResult)])
</span><a href="Unison.Server.Endpoints.FuzzyFind.html#serveFuzzyFind"><span class="hs-identifier hs-var">serveFuzzyFind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Handler ()
</span><a href="#local-6989586621681830127"><span class="hs-identifier hs-var">tryAuth</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621681830121"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621681830132"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-306"></span></pre></body></html>