<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- ORMOLU_DISABLE -}</span><span> </span><span class="hs-comment">-- Remove this when the file is ready to be auto-formatted</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-partial-type-signatures #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Editor.HandleCommand</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Random</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Random</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Configurator</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Config</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Configurator.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Config</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Branch</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Merge</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.AuthorInfo.html"><span class="hs-identifier">Unison.Codebase.Editor.AuthorInfo</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AuthorInfo</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html"><span class="hs-identifier">Unison.Codebase.Editor.Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Command"><span class="hs-identifier">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LexedSource"><span class="hs-identifier">LexedSource</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadSourceResult"><span class="hs-identifier">LoadSourceResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#SourceName"><span class="hs-identifier">SourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TypecheckingResult"><span class="hs-identifier">TypecheckingResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#UseCache"><span class="hs-identifier">UseCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html"><span class="hs-identifier">Unison.Codebase.Editor.Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#NumberedArgs"><span class="hs-identifier">NumberedArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#NumberedOutput"><span class="hs-identifier">NumberedOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#Output"><span class="hs-identifier">Output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Runtime</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Runtime</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.FileParsers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">parseAndSynthesizeFile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">synthesizeFile'</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hashing.V2.Convert</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hashing</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parser</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ann</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parsers</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parsers</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Result</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Result</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.CodebaseServer</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UF</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Free</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Free</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Free</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Free</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.WatchKind</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WK</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Browser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">openBrowser</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withArgs</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.FuzzySelect.html"><span class="hs-identifier">Unison.CommandLine.FuzzySelect</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fuzzy</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span id="local-6989586621679913483"><span id="local-6989586621679913484"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#typecheck"><span class="hs-identifier hs-type">typecheck</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679913484"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679913483"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679913483"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679913484"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913483"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser.ParsingEnv</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LexedSource"><span class="hs-identifier hs-type">LexedSource</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679913484"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TypecheckingResult"><span class="hs-identifier hs-type">TypecheckingResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913483"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-66"></span><span id="typecheck"><span class="annot"><span class="annottext">typecheck :: [Type v Ann]
-&gt; Codebase m v Ann
-&gt; ParsingEnv
-&gt; SourceName
-&gt; LexedSource
-&gt; m (TypecheckingResult v)
</span><a href="Unison.Codebase.Editor.HandleCommand.html#typecheck"><span class="hs-identifier hs-var hs-var">typecheck</span></a></span></span><span> </span><span id="local-6989586621679913277"><span class="annot"><span class="annottext">[Type v Ann]
</span><a href="#local-6989586621679913277"><span class="hs-identifier hs-var">ambient</span></a></span></span><span> </span><span id="local-6989586621679913276"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679913276"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679913275"><span class="annot"><span class="annottext">ParsingEnv
</span><a href="#local-6989586621679913275"><span class="hs-identifier hs-var">parsingEnv</span></a></span></span><span> </span><span id="local-6989586621679913274"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913274"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679913273"><span class="annot"><span class="annottext">LexedSource
</span><a href="#local-6989586621679913273"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="annottext">ResultT
  (Seq (Note v Ann)) m (Either Names (TypecheckedUnisonFile v Ann))
-&gt; m (TypecheckingResult v)
forall (f :: * -&gt; *) notes a.
Functor f =&gt;
ResultT notes f a -&gt; f (Result notes a)
</span><span class="hs-identifier hs-var">Result.getResult</span></span><span> </span><span class="annot"><span class="annottext">(ResultT
   (Seq (Note v Ann)) m (Either Names (TypecheckedUnisonFile v Ann))
 -&gt; m (TypecheckingResult v))
-&gt; ResultT
     (Seq (Note v Ann)) m (Either Names (TypecheckedUnisonFile v Ann))
-&gt; m (TypecheckingResult v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type v Ann]
-&gt; (Set Reference -&gt; m (TypeLookup v Ann))
-&gt; ParsingEnv
-&gt; FilePath
-&gt; SourceName
-&gt; ResultT
     (Seq (Note v Ann)) m (Either Names (TypecheckedUnisonFile v Ann))
forall v (m :: * -&gt; *).
(Var v, Monad m) =&gt;
[Type v]
-&gt; (Set Reference -&gt; m (TypeLookup v Ann))
-&gt; ParsingEnv
-&gt; FilePath
-&gt; SourceName
-&gt; ResultT
     (Seq (Note v Ann)) m (Either Names (TypecheckedUnisonFile v Ann))
</span><span class="hs-identifier hs-var">parseAndSynthesizeFile</span></span><span> </span><span class="annot"><span class="annottext">[Type v Ann]
</span><a href="#local-6989586621679913277"><span class="hs-identifier hs-var">ambient</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeLookup v Ann -&gt; TypeLookup v Ann -&gt; TypeLookup v Ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeLookup v Ann
forall v. Var v =&gt; TypeLookup v Ann
</span><span class="hs-identifier hs-var">B.typeLookup</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeLookup v Ann -&gt; TypeLookup v Ann)
-&gt; m (TypeLookup v Ann) -&gt; m (TypeLookup v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (TypeLookup v Ann) -&gt; m (TypeLookup v Ann))
-&gt; (Set Reference -&gt; m (TypeLookup v Ann))
-&gt; Set Reference
-&gt; m (TypeLookup v Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Set Reference -&gt; m (TypeLookup v Ann)
forall (m :: * -&gt; *) v a.
(Monad m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Set Reference -&gt; m (TypeLookup v a)
</span><span class="hs-identifier hs-var">Codebase.typeLookupForDependencies</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679913276"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">ParsingEnv
</span><a href="#local-6989586621679913275"><span class="hs-identifier hs-var">parsingEnv</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; FilePath
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913274"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LexedSource -&gt; SourceName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">LexedSource
</span><a href="#local-6989586621679913273"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span id="local-6989586621679913481"><span id="local-6989586621679913482"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#typecheck%27"><span class="hs-identifier hs-type">typecheck'</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679913482"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679913481"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679913481"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679913482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913481"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UF.UnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679913481"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679913482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TypecheckingResult"><span class="hs-identifier hs-type">TypecheckingResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913481"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-80"></span><span id="typecheck%27"><span class="annot"><span class="annottext">typecheck' :: [Type v Ann]
-&gt; Codebase m v Ann -&gt; UnisonFile v Ann -&gt; m (TypecheckingResult v)
</span><a href="Unison.Codebase.Editor.HandleCommand.html#typecheck%27"><span class="hs-identifier hs-var hs-var">typecheck'</span></a></span></span><span> </span><span id="local-6989586621679913265"><span class="annot"><span class="annottext">[Type v Ann]
</span><a href="#local-6989586621679913265"><span class="hs-identifier hs-var">ambient</span></a></span></span><span> </span><span id="local-6989586621679913264"><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679913264"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679913263"><span class="annot"><span class="annottext">UnisonFile v Ann
</span><a href="#local-6989586621679913263"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>  </span><span id="local-6989586621679913262"><span class="annot"><span class="annottext">TypeLookup v Ann
</span><a href="#local-6989586621679913262"><span class="hs-identifier hs-var">typeLookup</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeLookup v Ann -&gt; TypeLookup v Ann -&gt; TypeLookup v Ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeLookup v Ann
forall v. Var v =&gt; TypeLookup v Ann
</span><span class="hs-identifier hs-var">B.typeLookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">(TypeLookup v Ann -&gt; TypeLookup v Ann)
-&gt; m (TypeLookup v Ann) -&gt; m (TypeLookup v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann -&gt; Set Reference -&gt; m (TypeLookup v Ann)
forall (m :: * -&gt; *) v a.
(Monad m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Set Reference -&gt; m (TypeLookup v a)
</span><span class="hs-identifier hs-var">Codebase.typeLookupForDependencies</span></span><span> </span><span class="annot"><span class="annottext">Codebase m v Ann
</span><a href="#local-6989586621679913264"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnisonFile v Ann -&gt; Set Reference
forall a v. (Monoid a, Var v) =&gt; UnisonFile v a -&gt; Set Reference
</span><span class="hs-identifier hs-var">UF.dependencies</span></span><span> </span><span class="annot"><span class="annottext">UnisonFile v Ann
</span><a href="#local-6989586621679913263"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="annottext">TypecheckingResult v -&gt; m (TypecheckingResult v)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypecheckingResult v -&gt; m (TypecheckingResult v))
-&gt; (MaybeT
      (WriterT (Seq (Note v Ann)) Identity) (TypecheckedUnisonFile v Ann)
    -&gt; TypecheckingResult v)
-&gt; MaybeT
     (WriterT (Seq (Note v Ann)) Identity) (TypecheckedUnisonFile v Ann)
-&gt; m (TypecheckingResult v)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile v Ann
 -&gt; Either Names (TypecheckedUnisonFile v Ann))
-&gt; MaybeT
     (WriterT (Seq (Note v Ann)) Identity) (TypecheckedUnisonFile v Ann)
-&gt; TypecheckingResult v
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
-&gt; Either Names (TypecheckedUnisonFile v Ann)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT
   (WriterT (Seq (Note v Ann)) Identity) (TypecheckedUnisonFile v Ann)
 -&gt; m (TypecheckingResult v))
-&gt; MaybeT
     (WriterT (Seq (Note v Ann)) Identity) (TypecheckedUnisonFile v Ann)
-&gt; m (TypecheckingResult v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type v Ann]
-&gt; TypeLookup v Ann
-&gt; UnisonFile v Ann
-&gt; MaybeT
     (WriterT (Seq (Note v Ann)) Identity) (TypecheckedUnisonFile v Ann)
forall v.
Var v =&gt;
[Type v]
-&gt; TypeLookup v Ann
-&gt; UnisonFile v
-&gt; Result (Seq (Note v Ann)) (TypecheckedUnisonFile v Ann)
</span><span class="hs-identifier hs-var">synthesizeFile'</span></span><span> </span><span class="annot"><span class="annottext">[Type v Ann]
</span><a href="#local-6989586621679913265"><span class="hs-identifier hs-var">ambient</span></a></span><span> </span><span class="annot"><span class="annottext">TypeLookup v Ann
</span><a href="#local-6989586621679913262"><span class="hs-identifier hs-var">typeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnisonFile v Ann
</span><a href="#local-6989586621679913263"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#commandLine"><span class="hs-identifier hs-type">commandLine</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679913259"><span class="annot"><a href="#local-6989586621679913259"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679913258"><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679913257"><span class="annot"><a href="#local-6989586621679913257"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679913256"><span class="annot"><a href="#local-6989586621679913256"><span class="hs-identifier hs-type">gen</span></a></span></span><span>
</span><span id="line-87"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Random.DRG</span></span><span> </span><span class="annot"><a href="#local-6989586621679913256"><span class="hs-identifier hs-type">gen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Config</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913259"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Runtime</span></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#NumberedOutput"><span class="hs-identifier hs-type">NumberedOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#NumberedArgs"><span class="hs-identifier hs-type">NumberedArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadSourceResult"><span class="hs-identifier hs-type">LoadSourceResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server.BaseUrl</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913256"><span class="hs-identifier hs-type">gen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Free</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913259"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679913257"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913257"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-100"></span><span id="commandLine"><span class="annot"><span class="annottext">commandLine :: Config
-&gt; IO i
-&gt; (Branch IO -&gt; IO ())
-&gt; Runtime v
-&gt; (Output v -&gt; IO ())
-&gt; (NumberedOutput v -&gt; IO NumberedArgs)
-&gt; (SourceName -&gt; IO LoadSourceResult)
-&gt; Codebase IO v Ann
-&gt; Maybe BaseUrl
-&gt; (Int -&gt; IO gen)
-&gt; Free (Command IO i v) a
-&gt; IO a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#commandLine"><span class="hs-identifier hs-var hs-var">commandLine</span></a></span></span><span> </span><span id="local-6989586621679913255"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679913255"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679913254"><span class="annot"><span class="annottext">IO i
</span><a href="#local-6989586621679913254"><span class="hs-identifier hs-var">awaitInput</span></a></span></span><span> </span><span id="local-6989586621679913253"><span class="annot"><span class="annottext">Branch IO -&gt; IO ()
</span><a href="#local-6989586621679913253"><span class="hs-identifier hs-var">setBranchRef</span></a></span></span><span> </span><span id="local-6989586621679913252"><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679913251"><span class="annot"><span class="annottext">Output v -&gt; IO ()
</span><a href="#local-6989586621679913251"><span class="hs-identifier hs-var">notifyUser</span></a></span></span><span> </span><span id="local-6989586621679913250"><span class="annot"><span class="annottext">NumberedOutput v -&gt; IO NumberedArgs
</span><a href="#local-6989586621679913250"><span class="hs-identifier hs-var">notifyNumbered</span></a></span></span><span> </span><span id="local-6989586621679913249"><span class="annot"><span class="annottext">SourceName -&gt; IO LoadSourceResult
</span><a href="#local-6989586621679913249"><span class="hs-identifier hs-var">loadSource</span></a></span></span><span> </span><span id="local-6989586621679913248"><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679913247"><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621679913247"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span></span><span> </span><span id="local-6989586621679913246"><span class="annot"><span class="annottext">Int -&gt; IO gen
</span><a href="#local-6989586621679913246"><span class="hs-identifier hs-var">rngGen</span></a></span></span><span> </span><span id="local-6989586621679913245"><span class="annot"><span class="annottext">Free (Command IO i v) a
</span><a href="#local-6989586621679913245"><span class="hs-identifier hs-var">free</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span> </span><span id="local-6989586621679913244"><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679913244"><span class="hs-identifier hs-var">rndSeed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (TVar Int)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">STM.newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-102"></span><span> </span><span class="annot"><span class="annottext">(ReaderT (TVar Int) IO a -&gt; TVar Int -&gt; IO a)
-&gt; TVar Int -&gt; ReaderT (TVar Int) IO a -&gt; IO a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (TVar Int) IO a -&gt; TVar Int -&gt; IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679913244"><span class="hs-identifier hs-var">rndSeed</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (TVar Int) IO a -&gt; IO a)
-&gt; (Free (Command IO i v) a -&gt; ReaderT (TVar Int) IO a)
-&gt; Free (Command IO i v) a
-&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Command IO i v x -&gt; ReaderT (TVar Int) IO x)
-&gt; Free (Command IO i v) a -&gt; ReaderT (TVar Int) IO a
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command IO i v x -&gt; ReaderT (TVar Int) IO x
</span><a href="#local-6989586621679913240"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Free (Command IO i v) a -&gt; IO a)
-&gt; Free (Command IO i v) a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Free (Command IO i v) a
</span><a href="#local-6989586621679913245"><span class="hs-identifier hs-var">free</span></a></span><span>
</span><span id="line-103"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="#local-6989586621679913240"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679913239"><span class="annot"><a href="#local-6989586621679913239"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913259"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913239"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM.TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913239"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679913240"><span class="annot"><span class="annottext">go :: Command IO i v x -&gt; ReaderT (TVar Int) IO x
</span><a href="#local-6989586621679913240"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679913238"><span class="annot"><span class="annottext">Command IO i v x
</span><a href="#local-6989586621679913238"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="#local-6989586621679913238"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- Wait until we get either user input or a unison file update</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621679913236"><span class="annot"><span class="annottext">IO x
</span><a href="#local-6989586621679913236"><span class="hs-identifier hs-var">m</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO x -&gt; ReaderT (TVar Int) IO x
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">IO x
</span><a href="#local-6989586621679913236"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#UI"><span class="hs-identifier hs-var">UI</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621679913247"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679913233"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679913233"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; (IO Bool -&gt; IO ()) -&gt; IO Bool -&gt; ReaderT (TVar Int) IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; ReaderT (TVar Int) IO ())
-&gt; IO Bool -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><span class="hs-identifier hs-var">openBrowser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrlPath -&gt; BaseUrl -&gt; FilePath
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="annot"><span class="annottext">BaseUrlPath
</span><span class="hs-identifier hs-var">Server.UI</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679913233"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#DocsToHtml"><span class="hs-identifier hs-type">DocsToHtml</span></a></span><span> </span><span id="local-6989586621679913228"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913228"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span id="local-6989586621679913227"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679913227"><span class="hs-identifier hs-var">sourcePath</span></a></span></span><span> </span><span id="local-6989586621679913226"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913226"><span class="hs-identifier hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Runtime v
-&gt; Codebase IO v Ann -&gt; Branch IO -&gt; Path -&gt; FilePath -&gt; IO ()
forall v.
Var v =&gt;
Runtime v
-&gt; Codebase IO v Ann -&gt; Branch IO -&gt; Path -&gt; FilePath -&gt; IO ()
</span><span class="hs-identifier hs-var">Backend.docsInBranchToHtmlFiles</span></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913228"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679913227"><span class="hs-identifier hs-var">sourcePath</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913226"><span class="hs-identifier hs-var">destination</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO i -&gt; ReaderT (TVar Int) IO i
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">IO i
</span><a href="#local-6989586621679913254"><span class="hs-identifier hs-var">awaitInput</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Notify"><span class="hs-identifier hs-type">Notify</span></a></span><span> </span><span id="local-6989586621679913221"><span class="annot"><span class="annottext">Output v
</span><a href="#local-6989586621679913221"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Output v -&gt; IO ()
</span><a href="#local-6989586621679913251"><span class="hs-identifier hs-var">notifyUser</span></a></span><span> </span><span class="annot"><span class="annottext">Output v
</span><a href="#local-6989586621679913221"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#NotifyNumbered"><span class="hs-identifier hs-type">NotifyNumbered</span></a></span><span> </span><span id="local-6989586621679913219"><span class="annot"><span class="annottext">NumberedOutput v
</span><a href="#local-6989586621679913219"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO NumberedArgs -&gt; ReaderT (TVar Int) IO NumberedArgs
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO NumberedArgs -&gt; ReaderT (TVar Int) IO NumberedArgs)
-&gt; IO NumberedArgs -&gt; ReaderT (TVar Int) IO NumberedArgs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NumberedOutput v -&gt; IO NumberedArgs
</span><a href="#local-6989586621679913250"><span class="hs-identifier hs-var">notifyNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">NumberedOutput v
</span><a href="#local-6989586621679913219"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#ConfigLookup"><span class="hs-identifier hs-type">ConfigLookup</span></a></span><span> </span><span id="local-6989586621679913217"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913217"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>      </span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; ReaderT (TVar Int) IO (Maybe a)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe a) -&gt; ReaderT (TVar Int) IO (Maybe a))
-&gt; IO (Maybe a) -&gt; ReaderT (TVar Int) IO (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; SourceName -&gt; IO (Maybe a)
forall a. Configured a =&gt; Config -&gt; SourceName -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">Config.lookup</span></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679913255"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913217"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadSource"><span class="hs-identifier hs-type">LoadSource</span></a></span><span> </span><span id="local-6989586621679913214"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913214"><span class="hs-identifier hs-var">sourcePath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO LoadSourceResult -&gt; ReaderT (TVar Int) IO LoadSourceResult
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO LoadSourceResult -&gt; ReaderT (TVar Int) IO LoadSourceResult)
-&gt; IO LoadSourceResult -&gt; ReaderT (TVar Int) IO LoadSourceResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; IO LoadSourceResult
</span><a href="#local-6989586621679913249"><span class="hs-identifier hs-var">loadSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913214"><span class="hs-identifier hs-var">sourcePath</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Typecheck"><span class="hs-identifier hs-type">Typecheck</span></a></span><span> </span><span id="local-6989586621679913212"><span class="annot"><span class="annottext">AmbientAbilities v
</span><a href="#local-6989586621679913212"><span class="hs-identifier hs-var">ambient</span></a></span></span><span> </span><span id="local-6989586621679913211"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679913211"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679913210"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913210"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679913209"><span class="annot"><span class="annottext">LexedSource
</span><a href="#local-6989586621679913209"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-comment">-- todo: if guids are being shown to users,</span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-comment">-- not ideal to generate new guid every time</span><span>
</span><span id="line-126"></span><span>      </span><span id="local-6989586621679913208"><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679913208"><span class="hs-identifier hs-var">iVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (TVar Int) IO (TVar Int)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-127"></span><span>      </span><span id="local-6989586621679913207"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679913207"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM Int -&gt; ReaderT (TVar Int) IO Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM Int -&gt; ReaderT (TVar Int) IO Int)
-&gt; STM Int -&gt; ReaderT (TVar Int) IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>             </span><span id="local-6989586621679913205"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679913205"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; STM Int
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">STM.readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679913208"><span class="hs-identifier hs-var">iVar</span></a></span><span>
</span><span id="line-129"></span><span>             </span><span class="annot"><span class="annottext">TVar Int -&gt; Int -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">STM.writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679913208"><span class="hs-identifier hs-var">iVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679913205"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>             </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679913205"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-131"></span><span>      </span><span id="local-6989586621679913201"><span class="annot"><span class="annottext">gen
</span><a href="#local-6989586621679913201"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO gen -&gt; ReaderT (TVar Int) IO gen
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO gen -&gt; ReaderT (TVar Int) IO gen)
-&gt; IO gen -&gt; ReaderT (TVar Int) IO gen
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO gen
</span><a href="#local-6989586621679913246"><span class="hs-identifier hs-var">rngGen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679913207"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679913200"><span class="annot"><span class="annottext">namegen :: UniqueName
</span><a href="#local-6989586621679913200"><span class="hs-identifier hs-var hs-var">namegen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gen -&gt; UniqueName
forall gen. DRG gen =&gt; gen -&gt; UniqueName
</span><span class="hs-identifier hs-var">Parser.uniqueBase32Namegen</span></span><span> </span><span class="annot"><span class="annottext">gen
</span><a href="#local-6989586621679913201"><span class="hs-identifier hs-var">rng</span></a></span><span>
</span><span id="line-133"></span><span>          </span><span id="local-6989586621679913198"><span class="annot"><span class="annottext">env :: ParsingEnv
</span><a href="#local-6989586621679913198"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueName -&gt; NamesWithHistory -&gt; ParsingEnv
</span><span class="hs-identifier hs-var">Parser.ParsingEnv</span></span><span> </span><span class="annot"><span class="annottext">UniqueName
</span><a href="#local-6989586621679913200"><span class="hs-identifier hs-var">namegen</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679913211"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="annottext">IO (TypecheckingResult v)
-&gt; ReaderT (TVar Int) IO (TypecheckingResult v)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (TypecheckingResult v)
 -&gt; ReaderT (TVar Int) IO (TypecheckingResult v))
-&gt; IO (TypecheckingResult v)
-&gt; ReaderT (TVar Int) IO (TypecheckingResult v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AmbientAbilities v
-&gt; Codebase IO v Ann
-&gt; ParsingEnv
-&gt; SourceName
-&gt; LexedSource
-&gt; IO (TypecheckingResult v)
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
[Type v Ann]
-&gt; Codebase m v Ann
-&gt; ParsingEnv
-&gt; SourceName
-&gt; LexedSource
-&gt; m (TypecheckingResult v)
</span><a href="Unison.Codebase.Editor.HandleCommand.html#typecheck"><span class="hs-identifier hs-var">typecheck</span></a></span><span> </span><span class="annot"><span class="annottext">AmbientAbilities v
</span><a href="#local-6989586621679913212"><span class="hs-identifier hs-var">ambient</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ParsingEnv
</span><a href="#local-6989586621679913198"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913210"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">LexedSource
</span><a href="#local-6989586621679913209"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TypecheckFile"><span class="hs-identifier hs-type">TypecheckFile</span></a></span><span> </span><span id="local-6989586621679913195"><span class="annot"><span class="annottext">UnisonFile v Ann
</span><a href="#local-6989586621679913195"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621679913194"><span class="annot"><span class="annottext">AmbientAbilities v
</span><a href="#local-6989586621679913194"><span class="hs-identifier hs-var">ambient</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (TypecheckingResult v)
-&gt; ReaderT (TVar Int) IO (TypecheckingResult v)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (TypecheckingResult v)
 -&gt; ReaderT (TVar Int) IO (TypecheckingResult v))
-&gt; IO (TypecheckingResult v)
-&gt; ReaderT (TVar Int) IO (TypecheckingResult v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AmbientAbilities v
-&gt; Codebase IO v Ann
-&gt; UnisonFile v Ann
-&gt; IO (TypecheckingResult v)
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
[Type v Ann]
-&gt; Codebase m v Ann -&gt; UnisonFile v Ann -&gt; m (TypecheckingResult v)
</span><a href="Unison.Codebase.Editor.HandleCommand.html#typecheck%27"><span class="hs-identifier hs-var">typecheck'</span></a></span><span> </span><span class="annot"><span class="annottext">AmbientAbilities v
</span><a href="#local-6989586621679913194"><span class="hs-identifier hs-var">ambient</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">UnisonFile v Ann
</span><a href="#local-6989586621679913195"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Evaluate"><span class="hs-identifier hs-type">Evaluate</span></a></span><span> </span><span id="local-6989586621679913192"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913192"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679913191"><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679913191"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO
  (Either
     Error
     ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
-&gt; ReaderT
     (TVar Int)
     IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either
      Error
      ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
 -&gt; ReaderT
      (TVar Int)
      IO
      (Either
         Error
         ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))))
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
-&gt; ReaderT
     (TVar Int)
     IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; TypecheckedUnisonFile v Ann
-&gt; NumberedArgs
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
</span><a href="#local-6989586621679913190"><span class="hs-identifier hs-var">evalUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913192"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679913191"><span class="hs-identifier hs-var">unisonFile</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Evaluate1"><span class="hs-identifier hs-type">Evaluate1</span></a></span><span> </span><span id="local-6989586621679913188"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913188"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679913187"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679913187"><span class="hs-identifier hs-var">useCache</span></a></span></span><span> </span><span id="local-6989586621679913186"><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913186"><span class="hs-identifier hs-var">term</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either Error (Term v Ann))
-&gt; ReaderT (TVar Int) IO (Either Error (Term v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either Error (Term v Ann))
 -&gt; ReaderT (TVar Int) IO (Either Error (Term v Ann)))
-&gt; IO (Either Error (Term v Ann))
-&gt; ReaderT (TVar Int) IO (Either Error (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Bool -&gt; Term v Ann -&gt; IO (Either Error (Term v Ann))
</span><a href="#local-6989586621679913185"><span class="hs-identifier hs-var">eval1</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913188"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679913187"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913186"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#LoadLocalRootBranch"><span class="hs-identifier hs-var">LoadLocalRootBranch</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO))
-&gt; IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(GetRootBranchError -&gt; Branch IO)
-&gt; (Branch IO -&gt; Branch IO)
-&gt; Either GetRootBranchError (Branch IO)
-&gt; Branch IO
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; GetRootBranchError -&gt; Branch IO
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
forall (m :: * -&gt; *). Branch m
</span><span class="hs-identifier hs-var">Branch.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch IO
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(Either GetRootBranchError (Branch IO) -&gt; Branch IO)
-&gt; IO (Either GetRootBranchError (Branch IO)) -&gt; IO (Branch IO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO (Either GetRootBranchError (Branch IO))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; m (Either GetRootBranchError (Branch m))
</span><span class="hs-identifier hs-var hs-var">Codebase.getRootBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadLocalBranch"><span class="hs-identifier hs-type">LoadLocalBranch</span></a></span><span> </span><span id="local-6989586621679913177"><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679913177"><span class="hs-identifier hs-var">h</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO))
-&gt; IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Maybe (Branch IO) -&gt; Branch IO
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
forall (m :: * -&gt; *). Branch m
</span><span class="hs-identifier hs-var">Branch.empty</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Branch IO) -&gt; Branch IO)
-&gt; IO (Maybe (Branch IO)) -&gt; IO (Branch IO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Hash -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Hash -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.getBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621679913177"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Merge"><span class="hs-identifier hs-type">Merge</span></a></span><span> </span><span id="local-6989586621679913173"><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679913173"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679913172"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913172"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621679913171"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913171"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO))
-&gt; IO (Branch IO) -&gt; ReaderT (TVar Int) IO (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679913173"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913172"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913171"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#SyncLocalRootBranch"><span class="hs-identifier hs-type">SyncLocalRootBranch</span></a></span><span> </span><span id="local-6989586621679913167"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913167"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">Branch IO -&gt; IO ()
</span><a href="#local-6989586621679913253"><span class="hs-identifier hs-var">setBranchRef</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913167"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Branch IO -&gt; IO ()
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; Branch m -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putRootBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913167"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#ViewRemoteBranch"><span class="hs-identifier hs-type">ViewRemoteBranch</span></a></span><span> </span><span id="local-6989586621679913164"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679913164"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679913163"><span class="annot"><span class="annottext">Branch IO -&gt; Free (Command IO i v) r
</span><a href="#local-6989586621679913163"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-comment">-- TODO: We probably won'd need to unlift anything once we remove the Command</span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-comment">-- abstraction.</span><span>
</span><span id="line-148"></span><span>      </span><span id="local-6989586621679913162"><span class="annot"><span class="annottext">ReaderT (TVar Int) IO r -&gt; IO r
</span><a href="#local-6989586621679913162"><span class="hs-identifier hs-var">toIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (TVar Int) IO (ReaderT (TVar Int) IO r -&gt; IO r)
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; m (m a -&gt; IO a)
</span><span class="hs-identifier hs-var">UnliftIO.askRunInIO</span></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">IO (Either GitError r) -&gt; ReaderT (TVar Int) IO (Either GitError r)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either GitError r)
 -&gt; ReaderT (TVar Int) IO (Either GitError r))
-&gt; IO (Either GitError r)
-&gt; ReaderT (TVar Int) IO (Either GitError r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; ReadRemoteNamespace
-&gt; (Branch IO -&gt; IO r)
-&gt; IO (Either GitError r)
forall (m :: * -&gt; *) v a r.
MonadIO m =&gt;
Codebase m v a
-&gt; ReadRemoteNamespace
-&gt; (Branch m -&gt; m r)
-&gt; m (Either GitError r)
</span><span class="hs-identifier hs-var">Codebase.viewRemoteBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679913164"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT (TVar Int) IO r -&gt; IO r
</span><a href="#local-6989586621679913162"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (TVar Int) IO r -&gt; IO r)
-&gt; (Branch IO -&gt; ReaderT (TVar Int) IO r) -&gt; Branch IO -&gt; IO r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Command IO i v x -&gt; ReaderT (TVar Int) IO x)
-&gt; Free (Command IO i v) r -&gt; ReaderT (TVar Int) IO r
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command IO i v x -&gt; ReaderT (TVar Int) IO x
</span><a href="#local-6989586621679913240"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Free (Command IO i v) r -&gt; ReaderT (TVar Int) IO r)
-&gt; (Branch IO -&gt; Free (Command IO i v) r)
-&gt; Branch IO
-&gt; ReaderT (TVar Int) IO r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Free (Command IO i v) r
</span><a href="#local-6989586621679913163"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#ImportRemoteBranch"><span class="hs-identifier hs-type">ImportRemoteBranch</span></a></span><span> </span><span id="local-6989586621679913158"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679913158"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679913157"><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679913157"><span class="hs-identifier hs-var">syncMode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">IO (Either GitError (Branch IO))
-&gt; ReaderT (TVar Int) IO (Either GitError (Branch IO))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either GitError (Branch IO))
 -&gt; ReaderT (TVar Int) IO (Either GitError (Branch IO)))
-&gt; IO (Either GitError (Branch IO))
-&gt; ReaderT (TVar Int) IO (Either GitError (Branch IO))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; ReadRemoteNamespace
-&gt; SyncMode
-&gt; IO (Either GitError (Branch IO))
forall (m :: * -&gt; *) v a.
MonadUnliftIO m =&gt;
Codebase m v a
-&gt; ReadRemoteNamespace
-&gt; SyncMode
-&gt; m (Either GitError (Branch m))
</span><span class="hs-identifier hs-var">Codebase.importRemoteBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679913158"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679913157"><span class="hs-identifier hs-var">syncMode</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#SyncRemoteBranch"><span class="hs-identifier hs-type">SyncRemoteBranch</span></a></span><span> </span><span id="local-6989586621679913154"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913154"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span id="local-6989586621679913153"><span class="annot"><span class="annottext">WriteRepo
</span><a href="#local-6989586621679913153"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span id="local-6989586621679913152"><span class="annot"><span class="annottext">PushGitBranchOpts
</span><a href="#local-6989586621679913152"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">IO (Either GitError ())
-&gt; ReaderT (TVar Int) IO (Either GitError ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either GitError ())
 -&gt; ReaderT (TVar Int) IO (Either GitError ()))
-&gt; IO (Either GitError ())
-&gt; ReaderT (TVar Int) IO (Either GitError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; Branch IO
-&gt; WriteRepo
-&gt; PushGitBranchOpts
-&gt; IO (Either GitError ())
forall (m :: * -&gt; *) v a.
Codebase m v a
-&gt; Branch m
-&gt; WriteRepo
-&gt; PushGitBranchOpts
-&gt; m (Either GitError ())
</span><span class="hs-identifier hs-var hs-var">Codebase.pushGitBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913154"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">WriteRepo
</span><a href="#local-6989586621679913153"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">PushGitBranchOpts
</span><a href="#local-6989586621679913152"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadTerm"><span class="hs-identifier hs-type">LoadTerm</span></a></span><span> </span><span id="local-6989586621679913149"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913149"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Term v Ann))
-&gt; ReaderT (TVar Int) IO (Maybe (Term v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Term v Ann))
 -&gt; ReaderT (TVar Int) IO (Maybe (Term v Ann)))
-&gt; IO (Maybe (Term v Ann))
-&gt; ReaderT (TVar Int) IO (Maybe (Term v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; IO (Maybe (Term v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913149"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadType"><span class="hs-identifier hs-type">LoadType</span></a></span><span> </span><span id="local-6989586621679913146"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913146"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Decl v Ann))
-&gt; ReaderT (TVar Int) IO (Maybe (Decl v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Decl v Ann))
 -&gt; ReaderT (TVar Int) IO (Maybe (Decl v Ann)))
-&gt; IO (Maybe (Decl v Ann))
-&gt; ReaderT (TVar Int) IO (Maybe (Decl v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; IO (Maybe (Decl v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913146"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadTypeOfTerm"><span class="hs-identifier hs-type">LoadTypeOfTerm</span></a></span><span> </span><span id="local-6989586621679913143"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913143"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type v Ann))
-&gt; ReaderT (TVar Int) IO (Maybe (Type v Ann))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Type v Ann))
 -&gt; ReaderT (TVar Int) IO (Maybe (Type v Ann)))
-&gt; IO (Maybe (Type v Ann))
-&gt; ReaderT (TVar Int) IO (Maybe (Type v Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Reference -&gt; IO (Maybe (Type v Ann))
forall (m :: * -&gt; *) v a.
(Applicative m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Reference -&gt; m (Maybe (Type v a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913143"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#PutTerm"><span class="hs-identifier hs-type">PutTerm</span></a></span><span> </span><span id="local-6989586621679913140"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913140"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679913139"><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913139"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span id="local-6989586621679913138"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679913138"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; Term v Ann -&gt; Type v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Term v a -&gt; Type v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913140"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913139"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679913138"><span class="hs-identifier hs-var">tp</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#PutDecl"><span class="hs-identifier hs-type">PutDecl</span></a></span><span> </span><span id="local-6989586621679913135"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913135"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679913134"><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621679913134"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; Decl v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; Id -&gt; Decl v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913135"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Decl v Ann
</span><a href="#local-6989586621679913134"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#PutWatch"><span class="hs-identifier hs-type">PutWatch</span></a></span><span> </span><span id="local-6989586621679913131"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913131"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679913130"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913130"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679913129"><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913129"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; FilePath -&gt; Id -&gt; Term v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; FilePath -&gt; Id -&gt; Term v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913131"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913130"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913129"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadWatches"><span class="hs-identifier hs-type">LoadWatches</span></a></span><span> </span><span id="local-6989586621679913126"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913126"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679913125"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679913125"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [(Reference, Term v Ann)]
-&gt; ReaderT (TVar Int) IO [(Reference, Term v Ann)]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Reference, Term v Ann)]
 -&gt; ReaderT (TVar Int) IO [(Reference, Term v Ann)])
-&gt; IO [(Reference, Term v Ann)]
-&gt; ReaderT (TVar Int) IO [(Reference, Term v Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Reference, Term v Ann)] -&gt; [(Reference, Term v Ann)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Reference, Term v Ann)] -&gt; [(Reference, Term v Ann)])
-&gt; IO [Maybe (Reference, Term v Ann)]
-&gt; IO [(Reference, Term v Ann)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; IO (Maybe (Reference, Term v Ann)))
-&gt; [Reference] -&gt; IO [Maybe (Reference, Term v Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; IO (Maybe (Reference, Term v Ann))
</span><a href="#local-6989586621679913122"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679913125"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>      </span><span id="local-6989586621679913122"><span class="annot"><span class="annottext">go :: Reference -&gt; IO (Maybe (Reference, Term v Ann))
</span><a href="#local-6989586621679913122"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Reference, Term v Ann) -&gt; IO (Maybe (Reference, Term v Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Reference, Term v Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><a href="#local-6989586621679913122"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679913119"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621679913119"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679913117"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913117"><span class="hs-identifier hs-var">rid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">(Term v Ann -&gt; (Reference, Term v Ann))
-&gt; Maybe (Term v Ann) -&gt; Maybe (Reference, Term v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913119"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Term v Ann) -&gt; Maybe (Reference, Term v Ann))
-&gt; IO (Maybe (Term v Ann)) -&gt; IO (Maybe (Reference, Term v Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; FilePath -&gt; Id -&gt; IO (Maybe (Term v Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; FilePath -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913126"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913117"><span class="hs-identifier hs-var">rid</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#IsTerm"><span class="hs-identifier hs-type">IsTerm</span></a></span><span> </span><span id="local-6989586621679913114"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913114"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; ReaderT (TVar Int) IO Bool
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; ReaderT (TVar Int) IO Bool)
-&gt; IO Bool -&gt; ReaderT (TVar Int) IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Reference -&gt; IO Bool
forall (m :: * -&gt; *) v a.
(Applicative m, Var v, BuiltinAnnotation a) =&gt;
Codebase m v a -&gt; Reference -&gt; m Bool
</span><span class="hs-identifier hs-var">Codebase.isTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913114"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#IsType"><span class="hs-identifier hs-type">IsType</span></a></span><span> </span><span id="local-6989586621679913111"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913111"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; ReaderT (TVar Int) IO Bool
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; ReaderT (TVar Int) IO Bool)
-&gt; IO Bool -&gt; ReaderT (TVar Int) IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Reference -&gt; IO Bool
forall (m :: * -&gt; *) v a.
Applicative m =&gt;
Codebase m v a -&gt; Reference -&gt; m Bool
</span><span class="hs-identifier hs-var">Codebase.isType</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913111"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#GetDependents"><span class="hs-identifier hs-type">GetDependents</span></a></span><span> </span><span id="local-6989586621679913108"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913108"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference))
-&gt; IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913108"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#AddDefsToCodebase"><span class="hs-identifier hs-type">AddDefsToCodebase</span></a></span><span> </span><span id="local-6989586621679913105"><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679913105"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; TypecheckedUnisonFile v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679913105"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#GetTermsOfType"><span class="hs-identifier hs-type">GetTermsOfType</span></a></span><span> </span><span id="local-6989586621679913102"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679913102"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent))
-&gt; IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Type v Ann -&gt; IO (Set Referent)
forall v (m :: * -&gt; *) a.
(Var v, Functor m) =&gt;
Codebase m v a -&gt; Type v a -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Codebase.termsOfType</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679913102"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#GetTermsMentioningType"><span class="hs-identifier hs-type">GetTermsMentioningType</span></a></span><span> </span><span id="local-6989586621679913099"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679913099"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent))
-&gt; IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Type v Ann -&gt; IO (Set Referent)
forall v (m :: * -&gt; *) a.
(Var v, Functor m) =&gt;
Codebase m v a -&gt; Type v a -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Codebase.termsMentioningType</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679913099"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#CodebaseHashLength"><span class="hs-identifier hs-var">CodebaseHashLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; ReaderT (TVar Int) IO Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; ReaderT (TVar Int) IO Int)
-&gt; IO Int -&gt; ReaderT (TVar Int) IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- all builtin and derived type references</span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TypeReferencesByShortHash"><span class="hs-identifier hs-type">TypeReferencesByShortHash</span></a></span><span> </span><span id="local-6989586621679913094"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679913094"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference))
-&gt; IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; ShortHash -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Backend.typeReferencesByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679913094"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- all builtin and derived term references</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TermReferencesByShortHash"><span class="hs-identifier hs-type">TermReferencesByShortHash</span></a></span><span> </span><span id="local-6989586621679913091"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679913091"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference))
-&gt; IO (Set Reference) -&gt; ReaderT (TVar Int) IO (Set Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; ShortHash -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Backend.termReferencesByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679913091"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- all builtin and derived term references &amp; type constructors</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#TermReferentsByShortHash"><span class="hs-identifier hs-type">TermReferentsByShortHash</span></a></span><span> </span><span id="local-6989586621679913088"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679913088"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent))
-&gt; IO (Set Referent) -&gt; ReaderT (TVar Int) IO (Set Referent)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; ShortHash -&gt; IO (Set Referent)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Backend.termReferentsByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679913088"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#BranchHashLength"><span class="hs-identifier hs-var">BranchHashLength</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><span class="annottext">IO Int -&gt; ReaderT (TVar Int) IO Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; ReaderT (TVar Int) IO Int)
-&gt; IO Int -&gt; ReaderT (TVar Int) IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#BranchHashesByPrefix"><span class="hs-identifier hs-type">BranchHashesByPrefix</span></a></span><span> </span><span id="local-6989586621679913083"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679913083"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="annottext">IO (Set Hash) -&gt; ReaderT (TVar Int) IO (Set Hash)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Hash) -&gt; ReaderT (TVar Int) IO (Set Hash))
-&gt; IO (Set Hash) -&gt; ReaderT (TVar Int) IO (Set Hash)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; ShortBranchHash -&gt; IO (Set Hash)
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; ShortBranchHash -&gt; m (Set Hash)
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashesByPrefix</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679913083"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#ParseType"><span class="hs-identifier hs-type">ParseType</span></a></span><span> </span><span id="local-6989586621679913080"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679913080"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679913079"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913079"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Token Lexeme]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; ReaderT (TVar Int) IO x
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(x -&gt; ReaderT (TVar Int) IO x) -&gt; x -&gt; ReaderT (TVar Int) IO x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="annottext">FilePath -&gt; ParsingEnv -&gt; Either (Err v) (Type v Ann)
forall v.
Var v =&gt;
FilePath -&gt; ParsingEnv -&gt; Either (Err v) (Type v Ann)
</span><span class="hs-identifier hs-var">Parsers.parseType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; FilePath
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913079"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueName -&gt; NamesWithHistory -&gt; ParsingEnv
</span><span class="hs-identifier hs-var">Parser.ParsingEnv</span></span><span> </span><span class="annot"><span class="annottext">UniqueName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679913080"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#RuntimeMain"><span class="hs-identifier hs-var">RuntimeMain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type v Ann -&gt; ReaderT (TVar Int) IO (Type v Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type v Ann -&gt; ReaderT (TVar Int) IO (Type v Ann))
-&gt; Type v Ann -&gt; ReaderT (TVar Int) IO (Type v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Runtime v -&gt; Type v Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.mainType</span></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#RuntimeTest"><span class="hs-identifier hs-var">RuntimeTest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type v Ann -&gt; ReaderT (TVar Int) IO (Type v Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type v Ann -&gt; ReaderT (TVar Int) IO (Type v Ann))
-&gt; Type v Ann -&gt; ReaderT (TVar Int) IO (Type v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Runtime v -&gt; Type v Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.ioTestType</span></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">--    Todo b -&gt; doTodo codebase (Branch.head b)</span><span>
</span><span id="line-190"></span><span class="hs-comment">--    Propagate b -&gt; do</span><span>
</span><span id="line-191"></span><span class="hs-comment">--      b0 &lt;- Codebase.propagate codebase (Branch.head b)</span><span>
</span><span id="line-192"></span><span class="hs-comment">--      pure $ Branch.append b0 b</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Execute"><span class="hs-identifier hs-type">Execute</span></a></span><span> </span><span id="local-6989586621679913072"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913072"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679913071"><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679913071"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span id="local-6989586621679913070"><span class="annot"><span class="annottext">NumberedArgs
</span><a href="#local-6989586621679913070"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">IO
  (Either
     Error
     ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
-&gt; ReaderT
     (TVar Int)
     IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either
      Error
      ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
 -&gt; ReaderT
      (TVar Int)
      IO
      (Either
         Error
         ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))))
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
-&gt; ReaderT
     (TVar Int)
     IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; TypecheckedUnisonFile v Ann
-&gt; NumberedArgs
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
</span><a href="#local-6989586621679913190"><span class="hs-identifier hs-var">evalUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913072"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679913071"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">NumberedArgs
</span><a href="#local-6989586621679913070"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#AppendToReflog"><span class="hs-identifier hs-type">AppendToReflog</span></a></span><span> </span><span id="local-6989586621679913068"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913068"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621679913067"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913067"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621679913066"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913066"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; SourceName -&gt; Branch IO -&gt; Branch IO -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; SourceName -&gt; Branch m -&gt; Branch m -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.appendReflog</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913068"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913067"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913066"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#LoadReflog"><span class="hs-identifier hs-var">LoadReflog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [Entry Hash] -&gt; ReaderT (TVar Int) IO [Entry Hash]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO [Entry Hash] -&gt; ReaderT (TVar Int) IO [Entry Hash])
-&gt; IO [Entry Hash] -&gt; ReaderT (TVar Int) IO [Entry Hash]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO [Entry Hash]
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m [Entry Hash]
</span><span class="hs-identifier hs-var hs-var">Codebase.getReflog</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#CreateAuthorInfo"><span class="hs-identifier hs-type">CreateAuthorInfo</span></a></span><span> </span><span id="local-6989586621679913061"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913061"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; SourceName -&gt; ReaderT (TVar Int) IO (AuthorInfo v Ann)
forall (m :: * -&gt; *) v a.
(MonadIO m, Var v) =&gt;
a -&gt; SourceName -&gt; m (AuthorInfo v a)
</span><a href="Unison.Codebase.Editor.AuthorInfo.html#createAuthorInfo"><span class="hs-identifier hs-var">AuthorInfo.createAuthorInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679913061"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#HQNameQuery"><span class="hs-identifier hs-type">HQNameQuery</span></a></span><span> </span><span id="local-6989586621679913057"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679913057"><span class="hs-identifier hs-var">mayPath</span></a></span></span><span> </span><span id="local-6989586621679913056"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913056"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span id="local-6989586621679913055"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679913055"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679913054"><span class="annot"><span class="annottext">namingScope :: NameScoping
</span><a href="#local-6989586621679913054"><span class="hs-identifier hs-var hs-var">namingScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Path -&gt; NameScoping
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Path -&gt; Path
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.empty</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679913057"><span class="hs-identifier hs-var">mayPath</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><span class="annottext">IO QueryResult -&gt; ReaderT (TVar Int) IO QueryResult
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO QueryResult -&gt; ReaderT (TVar Int) IO QueryResult)
-&gt; IO QueryResult -&gt; ReaderT (TVar Int) IO QueryResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameScoping
-&gt; Branch IO
-&gt; Codebase IO v Ann
-&gt; [HashQualified Name]
-&gt; IO QueryResult
forall (m :: * -&gt; *) v.
Monad m =&gt;
NameScoping
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; [HashQualified Name]
-&gt; m QueryResult
</span><span class="hs-identifier hs-var">Backend.hqNameQuery</span></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679913054"><span class="hs-identifier hs-var">namingScope</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913056"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679913055"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoadSearchResults"><span class="hs-identifier hs-type">LoadSearchResults</span></a></span><span> </span><span id="local-6989586621679913049"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679913049"><span class="hs-identifier hs-var">srs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [SearchResult' v Ann]
-&gt; ReaderT (TVar Int) IO [SearchResult' v Ann]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO [SearchResult' v Ann]
 -&gt; ReaderT (TVar Int) IO [SearchResult' v Ann])
-&gt; IO [SearchResult' v Ann]
-&gt; ReaderT (TVar Int) IO [SearchResult' v Ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; [SearchResult] -&gt; IO [SearchResult' v Ann]
forall v (m :: * -&gt; *).
(Var v, Applicative m) =&gt;
Codebase m v Ann -&gt; [SearchResult] -&gt; m [SearchResult' v Ann]
</span><span class="hs-identifier hs-var">Backend.loadSearchResults</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679913049"><span class="hs-identifier hs-var">srs</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#GetDefinitionsBySuffixes"><span class="hs-identifier hs-type">GetDefinitionsBySuffixes</span></a></span><span> </span><span id="local-6989586621679913046"><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679913046"><span class="hs-identifier hs-var">mayPath</span></a></span></span><span> </span><span id="local-6989586621679913045"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913045"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span id="local-6989586621679913044"><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679913044"><span class="hs-identifier hs-var">includeCycles</span></a></span></span><span> </span><span id="local-6989586621679913043"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679913043"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679913042"><span class="annot"><span class="annottext">namingScope :: NameScoping
</span><a href="#local-6989586621679913042"><span class="hs-identifier hs-var hs-var">namingScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Path -&gt; NameScoping
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Path -&gt; Path
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.empty</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path
</span><a href="#local-6989586621679913046"><span class="hs-identifier hs-var">mayPath</span></a></span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">IO (DefinitionResults v)
-&gt; ReaderT (TVar Int) IO (DefinitionResults v)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameScoping
-&gt; Branch IO
-&gt; Codebase IO v Ann
-&gt; IncludeCycles
-&gt; [HashQualified Name]
-&gt; IO (DefinitionResults v)
forall (m :: * -&gt; *) v.
(MonadIO m, Var v) =&gt;
NameScoping
-&gt; Branch m
-&gt; Codebase m v Ann
-&gt; IncludeCycles
-&gt; [HashQualified Name]
-&gt; m (DefinitionResults v)
</span><span class="hs-identifier hs-var">Backend.definitionsBySuffixes</span></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679913042"><span class="hs-identifier hs-var">namingScope</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679913045"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679913044"><span class="hs-identifier hs-var">includeCycles</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679913043"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#FindShallow"><span class="hs-identifier hs-type">FindShallow</span></a></span><span> </span><span id="local-6989586621679913039"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679913039"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either BackendError [ShallowListEntry v Ann])
-&gt; ReaderT
     (TVar Int) IO (Either BackendError [ShallowListEntry v Ann])
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either BackendError [ShallowListEntry v Ann])
 -&gt; ReaderT
      (TVar Int) IO (Either BackendError [ShallowListEntry v Ann]))
-&gt; (ExceptT BackendError IO [ShallowListEntry v Ann]
    -&gt; IO (Either BackendError [ShallowListEntry v Ann]))
-&gt; ExceptT BackendError IO [ShallowListEntry v Ann]
-&gt; ReaderT
     (TVar Int) IO (Either BackendError [ShallowListEntry v Ann])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExceptT BackendError IO [ShallowListEntry v Ann]
-&gt; IO (Either BackendError [ShallowListEntry v Ann])
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT BackendError IO [ShallowListEntry v Ann]
 -&gt; ReaderT
      (TVar Int) IO (Either BackendError [ShallowListEntry v Ann]))
-&gt; ExceptT BackendError IO [ShallowListEntry v Ann]
-&gt; ReaderT
     (TVar Int) IO (Either BackendError [ShallowListEntry v Ann])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
-&gt; Absolute -&gt; ExceptT BackendError IO [ShallowListEntry v Ann]
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
Codebase m v Ann -&gt; Absolute -&gt; Backend m [ShallowListEntry v Ann]
</span><span class="hs-identifier hs-var">Backend.findShallow</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679913039"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#MakeStandalone"><span class="hs-identifier hs-type">MakeStandalone</span></a></span><span> </span><span id="local-6989586621679913036"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913036"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679913035"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913035"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679913034"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913034"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Error) -&gt; ReaderT (TVar Int) IO (Maybe Error)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Error) -&gt; ReaderT (TVar Int) IO (Maybe Error))
-&gt; IO (Maybe Error) -&gt; ReaderT (TVar Int) IO (Maybe Error)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679913033"><span class="annot"><span class="annottext">cl :: CodeLookup v IO Ann
</span><a href="#local-6989586621679913033"><span class="hs-identifier hs-var hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; CodeLookup v IO Ann
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; CodeLookup v m a
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="annottext">Runtime v
-&gt; CodeLookup v IO ()
-&gt; PrettyPrintEnv
-&gt; Reference
-&gt; FilePath
-&gt; IO (Maybe Error)
forall v.
Runtime v
-&gt; CodeLookup v IO ()
-&gt; PrettyPrintEnv
-&gt; Reference
-&gt; FilePath
-&gt; IO (Maybe Error)
</span><span class="hs-identifier hs-var hs-var">Runtime.compileTo</span></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; CodeLookup v IO Ann -&gt; CodeLookup v IO ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
</span><a href="#local-6989586621679913033"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913036"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679913035"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679913034"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;.uc&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#ClearWatchCache"><span class="hs-identifier hs-var">ClearWatchCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT (TVar Int) IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT (TVar Int) IO ())
-&gt; IO () -&gt; ReaderT (TVar Int) IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.clearWatches</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#FuzzySelect"><span class="hs-identifier hs-type">FuzzySelect</span></a></span><span> </span><span id="local-6989586621679913026"><span class="annot"><span class="annottext">Options
</span><a href="#local-6989586621679913026"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679913025"><span class="annot"><span class="annottext">a -&gt; SourceName
</span><a href="#local-6989586621679913025"><span class="hs-identifier hs-var">display</span></a></span></span><span> </span><span id="local-6989586621679913024"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679913024"><span class="hs-identifier hs-var">choices</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe [a]) -&gt; ReaderT (TVar Int) IO (Maybe [a])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe [a]) -&gt; ReaderT (TVar Int) IO (Maybe [a]))
-&gt; IO (Maybe [a]) -&gt; ReaderT (TVar Int) IO (Maybe [a])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Options -&gt; (a -&gt; SourceName) -&gt; [a] -&gt; IO (Maybe [a])
forall a. Options -&gt; (a -&gt; SourceName) -&gt; [a] -&gt; IO (Maybe [a])
</span><a href="Unison.CommandLine.FuzzySelect.html#fuzzySelect"><span class="hs-identifier hs-var">Fuzzy.fuzzySelect</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="#local-6989586621679913026"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SourceName
</span><a href="#local-6989586621679913025"><span class="hs-identifier hs-var">display</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679913024"><span class="hs-identifier hs-var">choices</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">Command IO i v x
</span><a href="Unison.Codebase.Editor.Command.html#CmdUnliftIO"><span class="hs-identifier hs-var">CmdUnliftIO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>      </span><span class="hs-comment">-- Get the unlifter for the ReaderT we're currently working in.</span><span>
</span><span id="line-214"></span><span>      </span><span id="local-6989586621679913021"><span class="annot"><span class="annottext">UnliftIO (ReaderT (TVar Int) IO)
</span><a href="#local-6989586621679913021"><span class="hs-identifier hs-var">unlifted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT (TVar Int) IO (UnliftIO (ReaderT (TVar Int) IO))
forall (m :: * -&gt; *). MonadUnliftIO m =&gt; m (UnliftIO m)
</span><span class="hs-identifier hs-var">UnliftIO.askUnliftIO</span></span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-comment">-- Built an unliftIO for the Free monad</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679913019"><span class="hs-identifier hs-type">runF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UnliftIO.UnliftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Free</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679913259"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>          </span><span id="local-6989586621679913019"><span class="annot"><span class="annottext">runF :: UnliftIO (Free (Command IO i v))
</span><a href="#local-6989586621679913019"><span class="hs-identifier hs-var hs-var">runF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. Free (Command IO i v) a -&gt; IO a)
-&gt; UnliftIO (Free (Command IO i v))
forall (m :: * -&gt; *). (forall a. m a -&gt; IO a) -&gt; UnliftIO m
</span><span class="hs-identifier hs-var">UnliftIO.UnliftIO</span></span><span> </span><span class="annot"><span class="annottext">((forall a. Free (Command IO i v) a -&gt; IO a)
 -&gt; UnliftIO (Free (Command IO i v)))
-&gt; (forall a. Free (Command IO i v) a -&gt; IO a)
-&gt; UnliftIO (Free (Command IO i v))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnliftIO (ReaderT (TVar Int) IO)
</span><a href="#local-6989586621679913021"><span class="hs-identifier hs-var">unlifted</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>                   </span><span class="hs-comment">-- We need to case-match on the UnliftIO within this function</span><span>
</span><span id="line-219"></span><span>                   </span><span class="hs-comment">-- because `toIO` is existential and we need the right types</span><span>
</span><span id="line-220"></span><span>                   </span><span class="hs-comment">-- in-scope.</span><span>
</span><span id="line-221"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">UnliftIO.UnliftIO</span></span><span> </span><span id="local-6989586621679913017"><span class="annot"><span class="annottext">forall a. ReaderT (TVar Int) IO a -&gt; IO a
</span><a href="#local-6989586621679913017"><span class="hs-identifier hs-var">toIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReaderT (TVar Int) IO a -&gt; IO a
forall a. ReaderT (TVar Int) IO a -&gt; IO a
</span><a href="#local-6989586621679913017"><span class="hs-identifier hs-var">toIO</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (TVar Int) IO a -&gt; IO a)
-&gt; (Free (Command IO i v) a -&gt; ReaderT (TVar Int) IO a)
-&gt; Free (Command IO i v) a
-&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Command IO i v x -&gt; ReaderT (TVar Int) IO x)
-&gt; Free (Command IO i v) a -&gt; ReaderT (TVar Int) IO a
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command IO i v x -&gt; ReaderT (TVar Int) IO x
</span><a href="#local-6989586621679913240"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">UnliftIO (Free (Command IO i v))
-&gt; ReaderT (TVar Int) IO (UnliftIO (Free (Command IO i v)))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">UnliftIO (Free (Command IO i v))
</span><a href="#local-6989586621679913019"><span class="hs-identifier hs-var">runF</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><a href="#local-6989586621679913016"><span class="hs-identifier hs-type">watchCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621679913016"><span class="annot"><span class="annottext">watchCache :: Id -&gt; IO (Maybe (Term v))
</span><a href="#local-6989586621679913016"><span class="hs-identifier hs-var hs-var">watchCache</span></a></span></span><span> </span><span id="local-6989586621679913015"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913015"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679913014"><span class="annot"><span class="annottext">Maybe (Term v Ann)
</span><a href="#local-6989586621679913014"><span class="hs-identifier hs-var">maybeTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; Id -&gt; IO (Maybe (Term v Ann))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.lookupWatchCache</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679913015"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Term v Ann -&gt; Term v
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Ann -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term v Ann -&gt; Term v) -&gt; Maybe (Term v Ann) -&gt; Maybe (Term v)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Term v Ann)
</span><a href="#local-6989586621679913014"><span class="hs-identifier hs-var">maybeTerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="#local-6989586621679913185"><span class="hs-identifier hs-type">eval1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#UseCache"><span class="hs-identifier hs-type">UseCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621679913185"><span class="annot"><span class="annottext">eval1 :: PrettyPrintEnv
-&gt; Bool -&gt; Term v Ann -&gt; IO (Either Error (Term v Ann))
</span><a href="#local-6989586621679913185"><span class="hs-identifier hs-var hs-var">eval1</span></a></span></span><span> </span><span id="local-6989586621679913011"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913011"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679913010"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679913010"><span class="hs-identifier hs-var">useCache</span></a></span></span><span> </span><span id="local-6989586621679913009"><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913009"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679913008"><span class="annot"><span class="annottext">codeLookup :: CodeLookup v IO Ann
</span><a href="#local-6989586621679913008"><span class="hs-identifier hs-var hs-var">codeLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; CodeLookup v IO Ann
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; CodeLookup v m a
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621679913007"><span class="annot"><span class="annottext">cache :: Id -&gt; IO (Maybe (Term v))
</span><a href="#local-6989586621679913007"><span class="hs-identifier hs-var hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679913010"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term v))
</span><a href="#local-6989586621679913016"><span class="hs-identifier hs-var">watchCache</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term v))
forall v. Id -&gt; IO (Maybe (Term v))
</span><span class="hs-identifier hs-var">Runtime.noCache</span></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679913005"><span class="annot"><span class="annottext">Either Error (Term v)
</span><a href="#local-6989586621679913005"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term v Ann
-&gt; IO (Either Error (Term v))
forall v a.
(Var v, Monoid a) =&gt;
CodeLookup v IO a
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term v a
-&gt; IO (Either Error (Term v))
</span><span class="hs-identifier hs-var">Runtime.evaluateTerm'</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
</span><a href="#local-6989586621679913008"><span class="hs-identifier hs-var">codeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term v))
</span><a href="#local-6989586621679913007"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679913011"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913009"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679913010"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Error (Term v)
</span><a href="#local-6989586621679913005"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679913002"><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679913002"><span class="hs-identifier hs-var">tmr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; FilePath -&gt; Id -&gt; Term v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; FilePath -&gt; Id -&gt; Term v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.RegularWatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v Ann -&gt; Id
forall v a. Var v =&gt; Term v a -&gt; Id
</span><span class="hs-identifier hs-var">Hashing.hashClosedTerm</span></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679913009"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term v -&gt; Term v Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679913002"><span class="hs-identifier hs-var">tmr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Error
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Either Error (Term v)
</span><a href="#local-6989586621679913005"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Either Error (Term v)
-&gt; (Term v -&gt; Term v Ann) -&gt; Either Error (Term v Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term v -&gt; Term v Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="#local-6989586621679913190"><span class="hs-identifier hs-type">evalUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679913258"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621679913190"><span class="annot"><span class="annottext">evalUnisonFile :: PrettyPrintEnv
-&gt; TypecheckedUnisonFile v Ann
-&gt; NumberedArgs
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
</span><a href="#local-6989586621679913190"><span class="hs-identifier hs-var hs-var">evalUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679912997"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679912997"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679912996"><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679912996"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span id="local-6989586621679912995"><span class="annot"><span class="annottext">NumberedArgs
</span><a href="#local-6989586621679912995"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NumberedArgs
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall a. NumberedArgs -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withArgs</span></span><span> </span><span class="annot"><span class="annottext">NumberedArgs
</span><a href="#local-6989586621679912995"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679912994"><span class="annot"><span class="annottext">codeLookup :: CodeLookup v IO Ann
</span><a href="#local-6989586621679912994"><span class="hs-identifier hs-var hs-var">codeLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; CodeLookup v IO Ann
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; CodeLookup v m a
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679912993"><span class="annot"><span class="annottext">Either
  Error
  ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
</span><a href="#local-6989586621679912993"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
-&gt; PrettyPrintEnv
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; Runtime v
-&gt; TypecheckedUnisonFile v Ann
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall v a.
Var v =&gt;
CodeLookup v IO a
-&gt; PrettyPrintEnv
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; Runtime v
-&gt; TypecheckedUnisonFile v a
-&gt; IO (WatchResults v a)
</span><span class="hs-identifier hs-var">Runtime.evaluateWatches</span></span><span> </span><span class="annot"><span class="annottext">CodeLookup v IO Ann
</span><a href="#local-6989586621679912994"><span class="hs-identifier hs-var">codeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679912997"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term v))
</span><a href="#local-6989586621679913016"><span class="hs-identifier hs-var">watchCache</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime v
</span><a href="#local-6989586621679913252"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679912996"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  Error
  ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
</span><a href="#local-6989586621679912993"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679912991"><span class="annot"><span class="annottext">Error
</span><a href="#local-6989586621679912991"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  Error
  ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
-&gt; IO
     (Either
        Error
        ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool)))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Error
-&gt; Either
     Error
     ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Error
</span><a href="#local-6989586621679912991"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679912990"><span class="annot"><span class="annottext">rs :: ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
</span><a href="#local-6989586621679912990"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(v, Term v)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679912989"><span class="annot"><span class="annottext">Map v (Ann, FilePath, Id, Term v, Term v, Bool)
</span><a href="#local-6989586621679912989"><span class="hs-identifier hs-var">map</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">[(Ann, FilePath, Id, Term v, Term v, Bool)]
-&gt; ((Ann, FilePath, Id, Term v, Term v, Bool) -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map v (Ann, FilePath, Id, Term v, Term v, Bool)
-&gt; [(Ann, FilePath, Id, Term v, Term v, Bool)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map v (Ann, FilePath, Id, Term v, Term v, Bool)
</span><a href="#local-6989586621679912989"><span class="hs-identifier hs-var">map</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Ann, FilePath, Id, Term v, Term v, Bool) -&gt; IO ()) -&gt; IO ())
-&gt; ((Ann, FilePath, Id, Term v, Term v, Bool) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679912986"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679912986"><span class="hs-identifier hs-var">_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679912985"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679912985"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679912984"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679912984"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679912983"><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679912983"><span class="hs-identifier hs-var">_src</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679912982"><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679912982"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679912981"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679912981"><span class="hs-identifier hs-var">isHit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679912981"><span class="hs-identifier hs-var">isHit</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679912980"><span class="annot"><span class="annottext">value' :: Term v Ann
</span><a href="#local-6989586621679912980"><span class="hs-identifier hs-var hs-var">value'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term v -&gt; Term v Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679912982"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">Codebase IO v Ann -&gt; FilePath -&gt; Id -&gt; Term v Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; FilePath -&gt; Id -&gt; Term v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO v Ann
</span><a href="#local-6989586621679913248"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679912985"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679912984"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679912980"><span class="hs-identifier hs-var">value'</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
-&gt; Either
     Error
     ([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">([(v, Term v)], Map v (Ann, FilePath, Id, Term v, Term v, Bool))
</span><a href="#local-6989586621679912990"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">-- doTodo :: Monad m =&gt; Codebase m v a -&gt; Branch0 -&gt; m (TodoOutput v a)</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- doTodo code b = do</span><span>
</span><span id="line-256"></span><span class="hs-comment">--   -- traceM $ &quot;edited terms: &quot; ++ show (Branch.editedTerms b)</span><span>
</span><span id="line-257"></span><span class="hs-comment">--   f &lt;- Codebase.frontier code b</span><span>
</span><span id="line-258"></span><span class="hs-comment">--   let dirty = R.dom f</span><span>
</span><span id="line-259"></span><span class="hs-comment">--       frontier = R.ran f</span><span>
</span><span id="line-260"></span><span class="hs-comment">--       ppe = Branch.prettyPrintEnv b</span><span>
</span><span id="line-261"></span><span class="hs-comment">--   (frontierTerms, frontierTypes) &lt;- loadDefinitions code frontier</span><span>
</span><span id="line-262"></span><span class="hs-comment">--   (dirtyTerms, dirtyTypes) &lt;- loadDefinitions code dirty</span><span>
</span><span id="line-263"></span><span class="hs-comment">--   -- todo: something more intelligent here?</span><span>
</span><span id="line-264"></span><span class="hs-comment">--   scoreFn &lt;- pure $ const 1</span><span>
</span><span id="line-265"></span><span class="hs-comment">--   remainingTransitive &lt;- Codebase.frontierTransitiveDependents code b frontier</span><span>
</span><span id="line-266"></span><span class="hs-comment">--   let</span><span>
</span><span id="line-267"></span><span class="hs-comment">--     addTermNames terms = [(PPE.termName ppe (Referent.Ref r), r, t) | (r,t) &lt;- terms ]</span><span>
</span><span id="line-268"></span><span class="hs-comment">--     addTypeNames types = [(PPE.typeName ppe r, r, d) | (r,d) &lt;- types ]</span><span>
</span><span id="line-269"></span><span class="hs-comment">--     frontierTermsNamed = addTermNames frontierTerms</span><span>
</span><span id="line-270"></span><span class="hs-comment">--     frontierTypesNamed = addTypeNames frontierTypes</span><span>
</span><span id="line-271"></span><span class="hs-comment">--     dirtyTermsNamed = sortOn (\(s,_,_,_) -&gt; s) $</span><span>
</span><span id="line-272"></span><span class="hs-comment">--       [ (scoreFn r, n, r, t) | (n,r,t) &lt;- addTermNames dirtyTerms ]</span><span>
</span><span id="line-273"></span><span class="hs-comment">--     dirtyTypesNamed = sortOn (\(s,_,_,_) -&gt; s) $</span><span>
</span><span id="line-274"></span><span class="hs-comment">--       [ (scoreFn r, n, r, t) | (n,r,t) &lt;- addTypeNames dirtyTypes ]</span><span>
</span><span id="line-275"></span><span class="hs-comment">--   pure $</span><span>
</span><span id="line-276"></span><span class="hs-comment">--     TodoOutput_</span><span>
</span><span id="line-277"></span><span class="hs-comment">--       (Set.size remainingTransitive)</span><span>
</span><span id="line-278"></span><span class="hs-comment">--       (frontierTermsNamed, frontierTypesNamed)</span><span>
</span><span id="line-279"></span><span class="hs-comment">--       (dirtyTermsNamed, dirtyTypesNamed)</span><span>
</span><span id="line-280"></span><span class="hs-comment">--       (Branch.conflicts' b)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- loadDefinitions :: Monad m =&gt; Codebase m v a -&gt; Set Reference</span><span>
</span><span id="line-283"></span><span class="hs-comment">--                 -&gt; m ( [(Reference, Maybe (Type v a))],</span><span>
</span><span id="line-284"></span><span class="hs-comment">--                        [(Reference, DisplayObject (Decl v a))] )</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- loadDefinitions code refs = do</span><span>
</span><span id="line-286"></span><span class="hs-comment">--   termRefs &lt;- filterM (Codebase.isTerm code) (toList refs)</span><span>
</span><span id="line-287"></span><span class="hs-comment">--   terms &lt;- forM termRefs $ \r -&gt; (r,) &lt;$&gt; Codebase.getTypeOfTerm code r</span><span>
</span><span id="line-288"></span><span class="hs-comment">--   typeRefs &lt;- filterM (Codebase.isType code) (toList refs)</span><span>
</span><span id="line-289"></span><span class="hs-comment">--   types &lt;- forM typeRefs $ \r -&gt; do</span><span>
</span><span id="line-290"></span><span class="hs-comment">--     case r of</span><span>
</span><span id="line-291"></span><span class="hs-comment">--       Reference.Builtin _ -&gt; pure (r, BuiltinThing)</span><span>
</span><span id="line-292"></span><span class="hs-comment">--       Reference.DerivedId id -&gt; do</span><span>
</span><span id="line-293"></span><span class="hs-comment">--         decl &lt;- Codebase.getTypeDeclaration code id</span><span>
</span><span id="line-294"></span><span class="hs-comment">--         case decl of</span><span>
</span><span id="line-295"></span><span class="hs-comment">--           Nothing -&gt; pure (r, MissingThing id)</span><span>
</span><span id="line-296"></span><span class="hs-comment">--           Just d -&gt; pure (r, RegularThing d)</span><span>
</span><span id="line-297"></span><span class="hs-comment">--   pure (terms, types)</span><span>
</span><span id="line-298"></span><span class="hs-comment">--</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- -- | Write all of the builtins into the codebase</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- initializeCodebase :: forall m . Monad m =&gt; Codebase m Symbol Ann -&gt; m ()</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- initializeCodebase c = do</span><span>
</span><span id="line-302"></span><span class="hs-comment">--   traverse_ (go Right) B.builtinDataDecls</span><span>
</span><span id="line-303"></span><span class="hs-comment">--   traverse_ (go Left)  B.builtinEffectDecls</span><span>
</span><span id="line-304"></span><span class="hs-comment">--   void $ fileToBranch updateCollisionHandler c mempty IOSource.typecheckedFile</span><span>
</span><span id="line-305"></span><span class="hs-comment">--  where</span><span>
</span><span id="line-306"></span><span class="hs-comment">--   go :: (t -&gt; Decl Symbol Ann) -&gt; (a, (Reference.Reference, t)) -&gt; m ()</span><span>
</span><span id="line-307"></span><span class="hs-comment">--   go f (_, (ref, decl)) = case ref of</span><span>
</span><span id="line-308"></span><span class="hs-comment">--     Reference.DerivedId id -&gt; Codebase.putTypeDeclaration c id (f decl)</span><span>
</span><span id="line-309"></span><span class="hs-comment">--     _                      -&gt; pure ()</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- -- todo: probably don't use this anywhere</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- nameDistance :: Name -&gt; Name -&gt; Maybe Int</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- nameDistance (Name.toString -&gt; q) (Name.toString -&gt; n) =</span><span>
</span><span id="line-314"></span><span class="hs-comment">--   if q == n                              then Just 0-- exact match is top choice</span><span>
</span><span id="line-315"></span><span class="hs-comment">--   else if map toLower q == map toLower n then Just 1-- ignore case</span><span>
</span><span id="line-316"></span><span class="hs-comment">--   else if q `isSuffixOf` n               then Just 2-- matching suffix is p.good</span><span>
</span><span id="line-317"></span><span class="hs-comment">--   else if q `isPrefixOf` n               then Just 3-- matching prefix</span><span>
</span><span id="line-318"></span><span class="hs-comment">--   else Nothing</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span></pre></body></html>