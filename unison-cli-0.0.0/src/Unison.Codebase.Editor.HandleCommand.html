<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-partial-type-signatures #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Editor.HandleCommand</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">local</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Cont</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html"><span class="hs-identifier">Unison.Codebase.Editor.Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Action"><span class="hs-identifier">Action</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Command"><span class="hs-identifier">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Env"><span class="hs-identifier">Env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoopState"><span class="hs-identifier">LoopState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html"><span class="hs-identifier">Unison.Codebase.Editor.Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Event"><span class="hs-identifier">Event</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier">Input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Free</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Free</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">data</span><span> </span><span id="ReturnType"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#ReturnType"><span class="hs-identifier hs-var">ReturnType</span></a></span></span><span> </span><span id="local-6989586621680024695"><span class="annot"><a href="#local-6989586621680024695"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Success"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-var">Success</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680024695"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HaltStep"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HaltRepl"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">data</span><span> </span><span id="Bailing"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Bailing"><span class="hs-identifier hs-var">Bailing</span></a></span></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="HaltingStep"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#HaltingStep"><span class="hs-identifier hs-var">HaltingStep</span></a></span></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HaltingRepl"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#HaltingRepl"><span class="hs-identifier hs-var">HaltingRepl</span></a></span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680024620"><span id="local-6989586621680024622"><span id="local-6989586621680024624"><span class="annot"><span class="annottext">Int -&gt; Bailing -&gt; ShowS
[Bailing] -&gt; ShowS
Bailing -&gt; String
(Int -&gt; Bailing -&gt; ShowS)
-&gt; (Bailing -&gt; String) -&gt; ([Bailing] -&gt; ShowS) -&gt; Show Bailing
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Bailing] -&gt; ShowS
$cshowList :: [Bailing] -&gt; ShowS
show :: Bailing -&gt; String
$cshow :: Bailing -&gt; String
showsPrec :: Int -&gt; Bailing -&gt; ShowS
$cshowsPrec :: Int -&gt; Bailing -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680024611"><span id="local-6989586621680024613"><span id="local-6989586621680024615"><span class="annot"><span class="annottext">Show Bailing
Typeable Bailing
Typeable Bailing
-&gt; Show Bailing
-&gt; (Bailing -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe Bailing)
-&gt; (Bailing -&gt; String)
-&gt; Exception Bailing
SomeException -&gt; Maybe Bailing
Bailing -&gt; String
Bailing -&gt; SomeException
forall e.
Typeable e
-&gt; Show e
-&gt; (e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; String)
-&gt; Exception e
displayException :: Bailing -&gt; String
$cdisplayException :: Bailing -&gt; String
fromException :: SomeException -&gt; Maybe Bailing
$cfromException :: SomeException -&gt; Maybe Bailing
toException :: Bailing -&gt; SomeException
$ctoException :: Bailing -&gt; SomeException
$cp2Exception :: Show Bailing
$cp1Exception :: Typeable Bailing
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">newtype</span><span> </span><span id="Cli"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-var">Cli</span></a></span></span><span> </span><span id="local-6989586621680024705"><span class="annot"><a href="#local-6989586621680024705"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680024706"><span class="annot"><a href="#local-6989586621680024706"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Cli"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-var">Cli</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunCli%3ACli"><span class="annot"><span class="annottext">Cli r a
-&gt; (a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r)
</span><a href="Unison.Codebase.Editor.HandleCommand.html#%24sel%3AunCli%3ACli"><span class="hs-identifier hs-var hs-var">unCli</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680024706"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#ReturnType"><span class="hs-identifier hs-type">ReturnType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024705"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#ReturnType"><span class="hs-identifier hs-type">ReturnType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024705"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621680024604"><span id="local-6989586621680024606"><span class="annot"><span class="annottext">a -&gt; Cli r b -&gt; Cli r a
(a -&gt; b) -&gt; Cli r a -&gt; Cli r b
(forall a b. (a -&gt; b) -&gt; Cli r a -&gt; Cli r b)
-&gt; (forall a b. a -&gt; Cli r b -&gt; Cli r a) -&gt; Functor (Cli r)
forall a b. a -&gt; Cli r b -&gt; Cli r a
forall a b. (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
forall r a b. a -&gt; Cli r b -&gt; Cli r a
forall r a b. (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; Cli r b -&gt; Cli r a
$c&lt;$ :: forall r a b. a -&gt; Cli r b -&gt; Cli r a
fmap :: (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
$cfmap :: forall r a b. (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>      </span><span id="local-6989586621680024592"><span id="local-6989586621680024594"><span id="local-6989586621680024596"><span id="local-6989586621680024598"><span id="local-6989586621680024600"><span class="annot"><span class="annottext">Functor (Cli r)
a -&gt; Cli r a
Functor (Cli r)
-&gt; (forall a. a -&gt; Cli r a)
-&gt; (forall a b. Cli r (a -&gt; b) -&gt; Cli r a -&gt; Cli r b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; Cli r a -&gt; Cli r b -&gt; Cli r c)
-&gt; (forall a b. Cli r a -&gt; Cli r b -&gt; Cli r b)
-&gt; (forall a b. Cli r a -&gt; Cli r b -&gt; Cli r a)
-&gt; Applicative (Cli r)
Cli r a -&gt; Cli r b -&gt; Cli r b
Cli r a -&gt; Cli r b -&gt; Cli r a
Cli r (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
(a -&gt; b -&gt; c) -&gt; Cli r a -&gt; Cli r b -&gt; Cli r c
forall r. Functor (Cli r)
forall a. a -&gt; Cli r a
forall r a. a -&gt; Cli r a
forall a b. Cli r a -&gt; Cli r b -&gt; Cli r a
forall a b. Cli r a -&gt; Cli r b -&gt; Cli r b
forall a b. Cli r (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
forall r a b. Cli r a -&gt; Cli r b -&gt; Cli r a
forall r a b. Cli r a -&gt; Cli r b -&gt; Cli r b
forall r a b. Cli r (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
forall a b c. (a -&gt; b -&gt; c) -&gt; Cli r a -&gt; Cli r b -&gt; Cli r c
forall r a b c. (a -&gt; b -&gt; c) -&gt; Cli r a -&gt; Cli r b -&gt; Cli r c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: Cli r a -&gt; Cli r b -&gt; Cli r a
$c&lt;* :: forall r a b. Cli r a -&gt; Cli r b -&gt; Cli r a
*&gt; :: Cli r a -&gt; Cli r b -&gt; Cli r b
$c*&gt; :: forall r a b. Cli r a -&gt; Cli r b -&gt; Cli r b
liftA2 :: (a -&gt; b -&gt; c) -&gt; Cli r a -&gt; Cli r b -&gt; Cli r c
$cliftA2 :: forall r a b c. (a -&gt; b -&gt; c) -&gt; Cli r a -&gt; Cli r b -&gt; Cli r c
&lt;*&gt; :: Cli r (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
$c&lt;*&gt; :: forall r a b. Cli r (a -&gt; b) -&gt; Cli r a -&gt; Cli r b
pure :: a -&gt; Cli r a
$cpure :: forall r a. a -&gt; Cli r a
$cp1Applicative :: forall r. Functor (Cli r)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>      </span><span id="local-6989586621680024584"><span id="local-6989586621680024586"><span id="local-6989586621680024588"><span class="annot"><span class="annottext">Applicative (Cli r)
a -&gt; Cli r a
Applicative (Cli r)
-&gt; (forall a b. Cli r a -&gt; (a -&gt; Cli r b) -&gt; Cli r b)
-&gt; (forall a b. Cli r a -&gt; Cli r b -&gt; Cli r b)
-&gt; (forall a. a -&gt; Cli r a)
-&gt; Monad (Cli r)
Cli r a -&gt; (a -&gt; Cli r b) -&gt; Cli r b
Cli r a -&gt; Cli r b -&gt; Cli r b
forall r. Applicative (Cli r)
forall a. a -&gt; Cli r a
forall r a. a -&gt; Cli r a
forall a b. Cli r a -&gt; Cli r b -&gt; Cli r b
forall a b. Cli r a -&gt; (a -&gt; Cli r b) -&gt; Cli r b
forall r a b. Cli r a -&gt; Cli r b -&gt; Cli r b
forall r a b. Cli r a -&gt; (a -&gt; Cli r b) -&gt; Cli r b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; Cli r a
$creturn :: forall r a. a -&gt; Cli r a
&gt;&gt; :: Cli r a -&gt; Cli r b -&gt; Cli r b
$c&gt;&gt; :: forall r a b. Cli r a -&gt; Cli r b -&gt; Cli r b
&gt;&gt;= :: Cli r a -&gt; (a -&gt; Cli r b) -&gt; Cli r b
$c&gt;&gt;= :: forall r a b. Cli r a -&gt; (a -&gt; Cli r b) -&gt; Cli r b
$cp1Monad :: forall r. Applicative (Cli r)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>      </span><span id="local-6989586621680024580"><span class="annot"><span class="annottext">Monad (Cli r)
Monad (Cli r) -&gt; (forall a. IO a -&gt; Cli r a) -&gt; MonadIO (Cli r)
IO a -&gt; Cli r a
forall r. Monad (Cli r)
forall a. IO a -&gt; Cli r a
forall r a. IO a -&gt; Cli r a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
liftIO :: IO a -&gt; Cli r a
$cliftIO :: forall r a. IO a -&gt; Cli r a
$cp1MonadIO :: forall r. Monad (Cli r)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>      </span><span id="local-6989586621680024572"><span id="local-6989586621680024574"><span id="local-6989586621680024576"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Env"><span class="hs-identifier hs-type">Env</span></a></span></span></span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#ReturnType"><span class="hs-identifier hs-type">ReturnType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024705"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- | 'withCliToIO' generalized to accept other monads that we can turn</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- into 'Cli' (e.g. Action)</span><span>
</span><span id="line-43"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#withCliToIO%27"><span class="hs-identifier hs-type">withCliToIO'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680024687"><span class="annot"><a href="#local-6989586621680024687"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680024688"><span class="annot"><a href="#local-6989586621680024688"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680024710"><span class="annot"><a href="#local-6989586621680024710"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680024709"><span class="annot"><a href="#local-6989586621680024709"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680024710"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024709"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024709"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024709"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680024710"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024709"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680024709"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680024688"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024687"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024688"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-44"></span><span id="withCliToIO%27"><span class="annot"><span class="annottext">withCliToIO' :: ((forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a)
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#withCliToIO%27"><span class="hs-identifier hs-var hs-var">withCliToIO'</span></a></span></span><span> </span><span id="local-6989586621680024568"><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a
</span><a href="#local-6989586621680024568"><span class="hs-identifier hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
forall r a.
((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-var">Cli</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024567"><span class="annot"><span class="annottext">a -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024567"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680024566"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024566"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>  </span><span id="local-6989586621680024565"><span class="annot"><span class="annottext">Either Bailing a
</span><a href="#local-6989586621680024565"><span class="hs-identifier hs-var">ea</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either Bailing a)
forall (m :: * -&gt; *) e a.
(MonadUnliftIO m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Either Bailing a)) -&gt; IO a -&gt; IO (Either Bailing a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="annottext">(forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a
</span><a href="#local-6989586621680024568"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a)
-&gt; (forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x)
-&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024563"><span class="annot"><span class="annottext">m x -&gt; Cli x x
</span><a href="#local-6989586621680024563"><span class="hs-identifier hs-var">toCli</span></a></span></span><span> </span><span id="local-6989586621680024562"><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621680024562"><span class="hs-identifier hs-var">someMonad</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span id="local-6989586621680024561"><span class="annot"><span class="annottext">(x -&gt; Env -&gt; IO (ReturnType x)) -&gt; Env -&gt; IO (ReturnType x)
</span><a href="#local-6989586621680024561"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m x -&gt; Cli x x
</span><a href="#local-6989586621680024563"><span class="hs-identifier hs-var">toCli</span></a></span><span> </span><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621680024562"><span class="hs-identifier hs-var">someMonad</span></a></span><span>
</span><span id="line-48"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(x -&gt; Env -&gt; IO (ReturnType x)) -&gt; Env -&gt; IO (ReturnType x)
</span><a href="#local-6989586621680024561"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680024560"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024560"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Env
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType x -&gt; IO (ReturnType x)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x -&gt; ReturnType x
forall a. a -&gt; ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024560"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024566"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IO (ReturnType x) -&gt; (ReturnType x -&gt; IO x) -&gt; IO x
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-49"></span><span>            </span><span class="annot"><span class="annottext">ReturnType x
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bailing -&gt; IO x
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.throwIO</span></span><span> </span><span class="annot"><span class="annottext">Bailing
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltingStep"><span class="hs-identifier hs-var">HaltingStep</span></a></span><span>
</span><span id="line-50"></span><span>            </span><span class="annot"><span class="annottext">ReturnType x
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bailing -&gt; IO x
forall (m :: * -&gt; *) e a. (MonadIO m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.throwIO</span></span><span> </span><span class="annot"><span class="annottext">Bailing
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltingRepl"><span class="hs-identifier hs-var">HaltingRepl</span></a></span><span>
</span><span id="line-51"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621680024558"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024558"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; IO x
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024558"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Bailing a
</span><a href="#local-6989586621680024565"><span class="hs-identifier hs-var">ea</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Bailing
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltingStep"><span class="hs-identifier hs-var">HaltingStep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; IO (ReturnType r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ReturnType r
forall a. ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Bailing
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltingRepl"><span class="hs-identifier hs-var">HaltingRepl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; IO (ReturnType r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ReturnType r
forall a. ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680024557"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680024557"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024567"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680024557"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024566"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Provide a way to run 'Cli' to IO. Note that this also delimits</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- the scope of and 'succeedWith' or 'with' calls.</span><span>
</span><span id="line-59"></span><span id="local-6989586621680024555"><span id="local-6989586621680024556"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#withCliToIO"><span class="hs-identifier hs-type">withCliToIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680024691"><span class="annot"><a href="#local-6989586621680024691"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024691"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024691"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680024691"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680024556"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024555"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024556"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-60"></span><span id="withCliToIO"><span class="annot"><span class="annottext">withCliToIO :: ((forall x. Cli x x -&gt; IO x) -&gt; IO a) -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#withCliToIO"><span class="hs-identifier hs-var hs-var">withCliToIO</span></a></span></span><span> </span><span id="local-6989586621680024553"><span class="annot"><span class="annottext">(forall x. Cli x x -&gt; IO x) -&gt; IO a
</span><a href="#local-6989586621680024553"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a)
-&gt; Cli r a
forall r a.
((forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a)
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#withCliToIO%27"><span class="hs-identifier hs-var">withCliToIO'</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024552"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x
</span><a href="#local-6989586621680024552"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall x. Cli x x -&gt; IO x) -&gt; IO a
</span><a href="#local-6989586621680024553"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Cli x x -&gt; Cli x x) -&gt; Cli x x -&gt; IO x
forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x
</span><a href="#local-6989586621680024552"><span class="hs-identifier hs-var">k'</span></a></span><span> </span><span class="annot"><span class="annottext">Cli x x -&gt; Cli x x
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span id="local-6989586621680024679"><span id="local-6989586621680024680"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#short"><span class="hs-identifier hs-type">short</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#ReturnType"><span class="hs-identifier hs-type">ReturnType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024680"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024680"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024679"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-63"></span><span id="short"><span class="annot"><span class="annottext">short :: ReturnType r -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#short"><span class="hs-identifier hs-var hs-var">short</span></a></span></span><span> </span><span id="local-6989586621680024549"><span class="annot"><span class="annottext">ReturnType r
</span><a href="#local-6989586621680024549"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
forall r a.
((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-var">Cli</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024548"><span class="annot"><span class="annottext">a -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024548"><span class="hs-identifier hs-var">_k</span></a></span></span><span> </span><span id="local-6989586621680024547"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024547"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; IO (ReturnType r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ReturnType r
</span><a href="#local-6989586621680024549"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Short-circuit success. Returns 'r' to the nearest enclosing</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- 'scopeWith'</span><span>
</span><span id="line-67"></span><span id="local-6989586621680024545"><span id="local-6989586621680024546"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#succeedWith"><span class="hs-identifier hs-type">succeedWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680024546"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024546"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024545"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-68"></span><span id="succeedWith"><span class="annot"><span class="annottext">succeedWith :: r -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#succeedWith"><span class="hs-identifier hs-var hs-var">succeedWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; Cli r a
forall r a. ReturnType r -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#short"><span class="hs-identifier hs-var">short</span></a></span><span> </span><span class="annot"><span class="annottext">(ReturnType r -&gt; Cli r a) -&gt; (r -&gt; ReturnType r) -&gt; r -&gt; Cli r a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; ReturnType r
forall a. a -&gt; ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Short-circuit success</span><span>
</span><span id="line-71"></span><span id="local-6989586621680024642"><span id="local-6989586621680024643"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#abortStep"><span class="hs-identifier hs-type">abortStep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024643"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024642"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-72"></span><span id="abortStep"><span class="annot"><span class="annottext">abortStep :: Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#abortStep"><span class="hs-identifier hs-var hs-var">abortStep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; Cli r a
forall r a. ReturnType r -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#short"><span class="hs-identifier hs-var">short</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnType r
forall a. ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Halt the repl</span><span>
</span><span id="line-75"></span><span id="local-6989586621680024540"><span id="local-6989586621680024541"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#haltRepl"><span class="hs-identifier hs-type">haltRepl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024541"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024540"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-76"></span><span id="haltRepl"><span class="annot"><span class="annottext">haltRepl :: Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#haltRepl"><span class="hs-identifier hs-var hs-var">haltRepl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; Cli r a
forall r a. ReturnType r -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#short"><span class="hs-identifier hs-var">short</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnType r
forall a. ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | Wrap a continuation with 'Cli'. Provides a nicer syntax to</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- resource acquiring functions.</span><span>
</span><span id="line-80"></span><span class="hs-comment">--</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- resource &lt;- with (bracket acquire close)</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-84"></span><span class="hs-comment">--</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Delimit the scope of acquired resources with 'scopeWith'.</span><span>
</span><span id="line-86"></span><span id="local-6989586621680024639"><span id="local-6989586621680024640"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#with"><span class="hs-identifier hs-type">with</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680024670"><span class="annot"><a href="#local-6989586621680024670"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680024640"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680024670"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680024670"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024639"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024640"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-87"></span><span id="with"><span class="annot"><span class="annottext">with :: (forall x. (a -&gt; IO x) -&gt; IO x) -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#with"><span class="hs-identifier hs-var hs-var">with</span></a></span></span><span> </span><span id="local-6989586621680024537"><span class="annot"><span class="annottext">forall x. (a -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621680024537"><span class="hs-identifier hs-var">resourceK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
forall r a.
((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-var">Cli</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024536"><span class="annot"><span class="annottext">a -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024536"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680024535"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024535"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO (ReturnType r)) -&gt; IO (ReturnType r)
forall x. (a -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621680024537"><span class="hs-identifier hs-var">resourceK</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680024534"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680024534"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024536"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680024534"><span class="hs-identifier hs-var">resource</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024535"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Delimit the scope of 'with' calls</span><span>
</span><span id="line-90"></span><span id="local-6989586621680024637"><span id="local-6989586621680024638"><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#scopeWith"><span class="hs-identifier hs-type">scopeWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024638"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024638"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024637"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024638"><span class="hs-identifier hs-type">x</span></a></span></span></span><span>
</span><span id="line-91"></span><span id="scopeWith"><span class="annot"><span class="annottext">scopeWith :: Cli x x -&gt; Cli r x
</span><a href="Unison.Codebase.Editor.HandleCommand.html#scopeWith"><span class="hs-identifier hs-var hs-var">scopeWith</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span id="local-6989586621680024532"><span class="annot"><span class="annottext">(x -&gt; Env -&gt; IO (ReturnType x)) -&gt; Env -&gt; IO (ReturnType x)
</span><a href="#local-6989586621680024532"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((x -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r x
forall r a.
((a -&gt; Env -&gt; IO (ReturnType r)) -&gt; Env -&gt; IO (ReturnType r))
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-var">Cli</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024531"><span class="annot"><span class="annottext">x -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024531"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680024530"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024530"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">(x -&gt; Env -&gt; IO (ReturnType x)) -&gt; Env -&gt; IO (ReturnType x)
</span><a href="#local-6989586621680024532"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680024529"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024529"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Env
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType x -&gt; IO (ReturnType x)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x -&gt; ReturnType x
forall a. a -&gt; ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024529"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024530"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IO (ReturnType x)
-&gt; (ReturnType x -&gt; IO (ReturnType r)) -&gt; IO (ReturnType r)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621680024528"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024528"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Env -&gt; IO (ReturnType r)
</span><a href="#local-6989586621680024531"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680024528"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024530"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">ReturnType x
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; IO (ReturnType r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ReturnType r
forall a. ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">ReturnType x
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType r -&gt; IO (ReturnType r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ReturnType r
forall a. ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#commandLine"><span class="hs-identifier hs-type">commandLine</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoopState"><span class="hs-identifier hs-type">LoopState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LoopState"><span class="hs-identifier hs-type">LoopState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span id="commandLine"><span class="annot"><span class="annottext">commandLine :: Env
-&gt; LoopState
-&gt; IO (Either Event Input)
-&gt; (Either Event Input -&gt; Action ())
-&gt; IO (Maybe (), LoopState)
</span><a href="Unison.Codebase.Editor.HandleCommand.html#commandLine"><span class="hs-identifier hs-var hs-var">commandLine</span></a></span></span><span> </span><span id="local-6989586621680024526"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024526"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span id="local-6989586621680024525"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024525"><span class="hs-identifier hs-var">loopState0</span></a></span></span><span> </span><span id="local-6989586621680024524"><span class="annot"><span class="annottext">IO (Either Event Input)
</span><a href="#local-6989586621680024524"><span class="hs-identifier hs-var">awaitInput</span></a></span></span><span> </span><span id="local-6989586621680024523"><span class="annot"><span class="annottext">Either Event Input -&gt; Action ()
</span><a href="#local-6989586621680024523"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621680024522"><span class="annot"><span class="annottext">IORef LoopState
</span><a href="#local-6989586621680024522"><span class="hs-identifier hs-var">loopStateRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LoopState -&gt; IO (IORef LoopState)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (IORef a)
</span><span class="hs-identifier hs-var">UnliftIO.newIORef</span></span><span> </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024525"><span class="hs-identifier hs-var">loopState0</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680024520"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680024650"><span class="annot"><a href="#local-6989586621680024650"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680024651"><span class="annot"><a href="#local-6989586621680024651"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024651"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024650"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680024651"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span id="local-6989586621680024520"><span class="annot"><span class="annottext">go :: Command x -&gt; Cli r x
</span><a href="#local-6989586621680024520"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680024519"><span class="annot"><span class="annottext">Command x
</span><a href="#local-6989586621680024519"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Command x
</span><a href="#local-6989586621680024519"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">Command x
</span><a href="Unison.Codebase.Editor.Command.html#AskEnv"><span class="hs-identifier hs-var">AskEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r x
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#LocalEnv"><span class="hs-identifier hs-type">LocalEnv</span></a></span><span> </span><span id="local-6989586621680024516"><span class="annot"><span class="annottext">Env -&gt; Env
</span><a href="#local-6989586621680024516"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680024515"><span class="annot"><span class="annottext">Free Command x
</span><a href="#local-6989586621680024515"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Env) -&gt; Cli r x -&gt; Cli r x
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; Env
</span><a href="#local-6989586621680024516"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. Command x -&gt; Cli r x) -&gt; Free Command x -&gt; Cli r x
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command x -&gt; Cli r x
forall r x. Command x -&gt; Cli r x
</span><a href="#local-6989586621680024520"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Free Command x
</span><a href="#local-6989586621680024515"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">Command x
</span><a href="Unison.Codebase.Editor.Command.html#GetLoopState"><span class="hs-identifier hs-var">GetLoopState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO LoopState -&gt; Cli r LoopState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef LoopState -&gt; IO LoopState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef LoopState
</span><a href="#local-6989586621680024522"><span class="hs-identifier hs-var">loopStateRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#PutLoopState"><span class="hs-identifier hs-type">PutLoopState</span></a></span><span> </span><span id="local-6989586621680024509"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024509"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef LoopState -&gt; LoopState -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">UnliftIO.writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef LoopState
</span><a href="#local-6989586621680024522"><span class="hs-identifier hs-var">loopStateRef</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024509"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621680024506"><span class="annot"><span class="annottext">IO x
</span><a href="#local-6989586621680024506"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO x -&gt; Cli r x
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO x
</span><a href="#local-6989586621680024506"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#WithRunInIO"><span class="hs-identifier hs-type">WithRunInIO</span></a></span><span> </span><span id="local-6989586621680024504"><span class="annot"><span class="annottext">(forall x. Action x -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621680024504"><span class="hs-identifier hs-var">doUnlifts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO x)
-&gt; Cli r x
forall r a.
((forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x) -&gt; IO a)
-&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#withCliToIO%27"><span class="hs-identifier hs-var">withCliToIO'</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680024503"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x
</span><a href="#local-6989586621680024503"><span class="hs-identifier hs-var">runInIO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>          </span><span class="annot"><span class="annottext">(forall x. Action x -&gt; IO x) -&gt; IO x
</span><a href="#local-6989586621680024504"><span class="hs-identifier hs-var">doUnlifts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span id="local-6989586621680024501"><span class="annot"><span class="annottext">Free Command x
</span><a href="#local-6989586621680024501"><span class="hs-identifier hs-var">free</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Free Command x -&gt; Cli x x) -&gt; Free Command x -&gt; IO x
forall (m :: * -&gt; *) x. (m x -&gt; Cli x x) -&gt; m x -&gt; IO x
</span><a href="#local-6989586621680024503"><span class="hs-identifier hs-var">runInIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. Command x -&gt; Cli x x) -&gt; Free Command x -&gt; Cli x x
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command x -&gt; Cli x x
forall r x. Command x -&gt; Cli r x
</span><a href="#local-6989586621680024520"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Free Command x
</span><a href="#local-6989586621680024501"><span class="hs-identifier hs-var">free</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">Command x
</span><a href="Unison.Codebase.Editor.Command.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r x
forall r a. Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#abortStep"><span class="hs-identifier hs-var">abortStep</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Command x
</span><a href="Unison.Codebase.Editor.Command.html#Quit"><span class="hs-identifier hs-var">Quit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r x
forall r a. Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#haltRepl"><span class="hs-identifier hs-var">haltRepl</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#WithResource"><span class="hs-identifier hs-type">WithResource</span></a></span><span> </span><span id="local-6989586621680024497"><span class="annot"><span class="annottext">forall r. (x -&gt; IO r) -&gt; IO r
</span><a href="#local-6989586621680024497"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall r. (x -&gt; IO r) -&gt; IO r) -&gt; Cli r x
forall a r. (forall x. (a -&gt; IO x) -&gt; IO x) -&gt; Cli r a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#with"><span class="hs-identifier hs-var">with</span></a></span><span> </span><span class="annot"><span class="annottext">forall r. (x -&gt; IO r) -&gt; IO r
</span><a href="#local-6989586621680024497"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Reset"><span class="hs-identifier hs-type">Reset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Command.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span id="local-6989586621680024495"><span class="annot"><span class="annottext">Free Command x
</span><a href="#local-6989586621680024495"><span class="hs-identifier hs-var">act</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli x x -&gt; Cli r x
forall x r. Cli x x -&gt; Cli r x
</span><a href="Unison.Codebase.Editor.HandleCommand.html#scopeWith"><span class="hs-identifier hs-var">scopeWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. Command x -&gt; Cli x x) -&gt; Free Command x -&gt; Cli x x
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command x -&gt; Cli x x
forall r x. Command x -&gt; Cli r x
</span><a href="#local-6989586621680024520"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Free Command x
</span><a href="#local-6989586621680024495"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621680024494"><span class="annot"><span class="annottext">Either Event Input
</span><a href="#local-6989586621680024494"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either Event Input)
</span><a href="#local-6989586621680024524"><span class="hs-identifier hs-var">awaitInput</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span id="local-6989586621680024493"><span class="annot"><span class="annottext">ReturnType ()
</span><a href="#local-6989586621680024493"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span id="local-6989586621680024492"><span class="annot"><span class="annottext">(() -&gt; Env -&gt; IO (ReturnType ())) -&gt; Env -&gt; IO (ReturnType ())
</span><a href="#local-6989586621680024492"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(() -&gt; Env -&gt; IO (ReturnType ())) -&gt; Env -&gt; IO (ReturnType ())
</span><a href="#local-6989586621680024492"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680024491"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680024491"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680024490"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024490"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReturnType () -&gt; IO (ReturnType ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ReturnType ()
forall a. a -&gt; ReturnType a
</span><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621680024491"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621680024526"><span class="hs-identifier hs-var">env0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli () () -&gt; IO (ReturnType ()))
-&gt; (Free Command () -&gt; Cli () ())
-&gt; Free Command ()
-&gt; IO (ReturnType ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall x. Command x -&gt; Cli () x) -&gt; Free Command () -&gt; Cli () ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Free f a -&gt; m a
</span><span class="hs-identifier hs-var">Free.fold</span></span><span> </span><span class="annot"><span class="annottext">forall x. Command x -&gt; Cli () x
forall r x. Command x -&gt; Cli r x
</span><a href="#local-6989586621680024520"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Free Command () -&gt; IO (ReturnType ()))
-&gt; Free Command () -&gt; IO (ReturnType ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Action () -&gt; Free Command ()
forall a. Action a -&gt; Free Command a
</span><a href="Unison.Codebase.Editor.Command.html#%24sel%3AunAction%3AAction"><span class="hs-identifier hs-var hs-var">unAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either Event Input -&gt; Action ()
</span><a href="#local-6989586621680024523"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">Either Event Input
</span><a href="#local-6989586621680024494"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621680024488"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024488"><span class="hs-identifier hs-var">finalState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef LoopState -&gt; IO LoopState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">UnliftIO.readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef LoopState
</span><a href="#local-6989586621680024522"><span class="hs-identifier hs-var">loopStateRef</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReturnType ()
</span><a href="#local-6989586621680024493"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleCommand.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Maybe ()
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024488"><span class="hs-identifier hs-var">finalState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">ReturnType ()
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltStep"><span class="hs-identifier hs-var">HaltStep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Maybe ()
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024488"><span class="hs-identifier hs-var">finalState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">ReturnType ()
</span><a href="Unison.Codebase.Editor.HandleCommand.html#HaltRepl"><span class="hs-identifier hs-var">HaltRepl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ()
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621680024488"><span class="hs-identifier hs-var">finalState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span></pre></body></html>