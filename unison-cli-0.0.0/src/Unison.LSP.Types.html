<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.LSP.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Colog.Core</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ki</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Logging</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSP</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Server</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Types</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Types.Lens</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.VFS</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Runtime</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.LSP.Orphans.html"><span class="hs-identifier">Unison.LSP.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Result</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Note</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Lexer</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lexer</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UF</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- | A custom LSP monad wrapper so we can provide our own environment.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">newtype</span><span> </span><span id="Lsp"><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-var">Lsp</span></a></span></span><span> </span><span id="local-6989586621679395273"><span class="annot"><a href="#local-6989586621679395273"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Lsp"><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-var">Lsp</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3ArunLspM%3ALsp"><span class="annot"><span class="annottext">Lsp a -&gt; ReaderT Env (LspM Config) a
</span><a href="Unison.LSP.Types.html#%24sel%3ArunLspM%3ALsp"><span class="hs-identifier hs-var hs-var">runLspM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LspM</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679395273"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679395267"><span id="local-6989586621679395269"><span class="annot"><span class="annottext">a -&gt; Lsp b -&gt; Lsp a
(a -&gt; b) -&gt; Lsp a -&gt; Lsp b
(forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b)
-&gt; (forall a b. a -&gt; Lsp b -&gt; Lsp a) -&gt; Functor Lsp
forall a b. a -&gt; Lsp b -&gt; Lsp a
forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; Lsp b -&gt; Lsp a
$c&lt;$ :: forall a b. a -&gt; Lsp b -&gt; Lsp a
fmap :: (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
$cfmap :: forall a b. (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679395255"><span id="local-6989586621679395257"><span id="local-6989586621679395259"><span id="local-6989586621679395261"><span id="local-6989586621679395263"><span class="annot"><span class="annottext">Functor Lsp
a -&gt; Lsp a
Functor Lsp
-&gt; (forall a. a -&gt; Lsp a)
-&gt; (forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c)
-&gt; (forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b)
-&gt; (forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a)
-&gt; Applicative Lsp
Lsp a -&gt; Lsp b -&gt; Lsp b
Lsp a -&gt; Lsp b -&gt; Lsp a
Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
(a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
forall a. a -&gt; Lsp a
forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a
forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
&lt;* :: Lsp a -&gt; Lsp b -&gt; Lsp a
$c&lt;* :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp a
*&gt; :: Lsp a -&gt; Lsp b -&gt; Lsp b
$c*&gt; :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
liftA2 :: (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; Lsp a -&gt; Lsp b -&gt; Lsp c
&lt;*&gt; :: Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
$c&lt;*&gt; :: forall a b. Lsp (a -&gt; b) -&gt; Lsp a -&gt; Lsp b
pure :: a -&gt; Lsp a
$cpure :: forall a. a -&gt; Lsp a
$cp1Applicative :: Functor Lsp
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679395247"><span id="local-6989586621679395249"><span id="local-6989586621679395251"><span class="annot"><span class="annottext">Applicative Lsp
a -&gt; Lsp a
Applicative Lsp
-&gt; (forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b)
-&gt; (forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b)
-&gt; (forall a. a -&gt; Lsp a)
-&gt; Monad Lsp
Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
Lsp a -&gt; Lsp b -&gt; Lsp b
forall a. a -&gt; Lsp a
forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; Lsp a
$creturn :: forall a. a -&gt; Lsp a
&gt;&gt; :: Lsp a -&gt; Lsp b -&gt; Lsp b
$c&gt;&gt; :: forall a b. Lsp a -&gt; Lsp b -&gt; Lsp b
&gt;&gt;= :: Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
$c&gt;&gt;= :: forall a b. Lsp a -&gt; (a -&gt; Lsp b) -&gt; Lsp b
$cp1Monad :: Applicative Lsp
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679395243"><span class="annot"><span class="annottext">Monad Lsp
Monad Lsp -&gt; (forall a. IO a -&gt; Lsp a) -&gt; MonadIO Lsp
IO a -&gt; Lsp a
forall a. IO a -&gt; Lsp a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
liftIO :: IO a -&gt; Lsp a
$cliftIO :: forall a. IO a -&gt; Lsp a
$cp1MonadIO :: Monad Lsp
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679395239"><span class="annot"><span class="annottext">MonadIO Lsp
MonadIO Lsp
-&gt; (forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b)
-&gt; MonadUnliftIO Lsp
((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
forall (m :: * -&gt; *).
MonadIO m
-&gt; (forall b. ((forall a. m a -&gt; IO a) -&gt; IO b) -&gt; m b)
-&gt; MonadUnliftIO m
withRunInIO :: ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
$cwithRunInIO :: forall b. ((forall a. Lsp a -&gt; IO a) -&gt; IO b) -&gt; Lsp b
$cp1MonadUnliftIO :: MonadIO Lsp
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadUnliftIO</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679395231"><span id="local-6989586621679395233"><span id="local-6989586621679395235"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679395227"><span class="annot"><span class="hs-identifier hs-type">MonadLsp</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | Log an info message to the client's LSP log.</span><span>
</span><span id="line-37"></span><span class="annot"><a href="Unison.LSP.Types.html#logInfo"><span class="hs-identifier hs-type">logInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span id="logInfo"><span class="annot"><span class="annottext">logInfo :: Text -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#logInfo"><span class="hs-identifier hs-var hs-var">logInfo</span></a></span></span><span> </span><span id="local-6989586621679395224"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679395224"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span id="local-6989586621679395222"><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621679395222"><span class="hs-identifier hs-var">log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogAction Lsp (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><span class="hs-identifier hs-var">LSP.defaultClientLogger</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621679395222"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Severity -&gt; WithSeverity Text
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-identifier hs-var">WithSeverity</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679395224"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | Log an error message to the client's LSP log, this will be shown to the user in most LSP</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- implementations.</span><span>
</span><span id="line-44"></span><span class="annot"><a href="Unison.LSP.Types.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span id="logError"><span class="annot"><span class="annottext">logError :: Text -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#logError"><span class="hs-identifier hs-var hs-var">logError</span></a></span></span><span> </span><span id="local-6989586621679395217"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679395217"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span id="local-6989586621679395216"><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621679395216"><span class="hs-identifier hs-var">log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogAction Lsp (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><span class="hs-identifier hs-var">LSP.defaultClientLogger</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Lsp ()
</span><a href="#local-6989586621679395216"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Severity -&gt; WithSeverity Text
forall msg. msg -&gt; Severity -&gt; WithSeverity msg
</span><span class="hs-identifier hs-var">WithSeverity</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679395217"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Environment for the Lsp monad.</span><span>
</span><span id="line-50"></span><span class="hs-keyword">data</span><span> </span><span id="Env"><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Env"><span class="annot"><a href="Unison.LSP.Types.html#Env"><span class="hs-identifier hs-var">Env</span></a></span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- contains handlers for talking to the client.</span><span>
</span><span id="line-52"></span><span>    </span><span id="%24sel%3AlspContext%3AEnv"><span class="annot"><span class="annottext">Env -&gt; LanguageContextEnv Config
</span><a href="Unison.LSP.Types.html#%24sel%3AlspContext%3AEnv"><span class="hs-identifier hs-var hs-var">lspContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LanguageContextEnv</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span id="%24sel%3Acodebase%3AEnv"><span class="annot"><span class="annottext">Env -&gt; Codebase IO Symbol Ann
</span><a href="Unison.LSP.Types.html#%24sel%3Acodebase%3AEnv"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span id="%24sel%3AparseNamesCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO NamesWithHistory
</span><a href="Unison.LSP.Types.html#%24sel%3AparseNamesCache%3AEnv"><span class="hs-identifier hs-var hs-var">parseNamesCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span id="%24sel%3AppeCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO PrettyPrintEnvDecl
</span><a href="Unison.LSP.Types.html#%24sel%3AppeCache%3AEnv"><span class="hs-identifier hs-var hs-var">ppeCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span id="%24sel%3AcurrentPathCache%3AEnv"><span class="annot"><span class="annottext">Env -&gt; IO Absolute
</span><a href="Unison.LSP.Types.html#%24sel%3AcurrentPathCache%3AEnv"><span class="hs-identifier hs-var hs-var">currentPathCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span id="%24sel%3AvfsVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; MVar VFS
</span><a href="Unison.LSP.Types.html#%24sel%3AvfsVar%3AEnv"><span class="hs-identifier hs-var hs-var">vfsVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VFS</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span id="%24sel%3Aruntime%3AEnv"><span class="annot"><span class="annottext">Env -&gt; Runtime Symbol
</span><a href="Unison.LSP.Types.html#%24sel%3Aruntime%3AEnv"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Runtime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- The information we have for each file, which may or may not have a valid parse or</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-comment">-- typecheck.</span><span>
</span><span id="line-61"></span><span>    </span><span id="%24sel%3AcheckedFilesVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; TVar (Map Uri FileAnalysis)
</span><a href="Unison.LSP.Types.html#%24sel%3AcheckedFilesVar%3AEnv"><span class="hs-identifier hs-var hs-var">checkedFilesVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#FileAnalysis"><span class="hs-identifier hs-type">FileAnalysis</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span id="%24sel%3AdirtyFilesVar%3AEnv"><span class="annot"><span class="annottext">Env -&gt; TVar (Set Uri)
</span><a href="Unison.LSP.Types.html#%24sel%3AdirtyFilesVar%3AEnv"><span class="hs-identifier hs-var hs-var">dirtyFilesVar</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span id="%24sel%3Ascope%3AEnv"><span class="annot"><span class="annottext">Env -&gt; Scope
</span><a href="Unison.LSP.Types.html#%24sel%3Ascope%3AEnv"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ki.Scope</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | A monotonically increasing file version tracked by the lsp client.</span><span>
</span><span id="line-67"></span><span class="hs-keyword">type</span><span> </span><span id="FileVersion"><span class="annot"><a href="Unison.LSP.Types.html#FileVersion"><span class="hs-identifier hs-var">FileVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">type</span><span> </span><span id="LexedSource"><span class="annot"><a href="Unison.LSP.Types.html#LexedSource"><span class="hs-identifier hs-var">LexedSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Lexer.Token</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lexer.Lexeme</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">data</span><span> </span><span id="FileAnalysis"><span class="annot"><a href="Unison.LSP.Types.html#FileAnalysis"><span class="hs-identifier hs-var">FileAnalysis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FileAnalysis"><span class="annot"><a href="Unison.LSP.Types.html#FileAnalysis"><span class="hs-identifier hs-var">FileAnalysis</span></a></span></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AfileUri%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Uri
</span><a href="Unison.LSP.Types.html#%24sel%3AfileUri%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">fileUri</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Uri</span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span id="%24sel%3AfileVersion%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; FileVersion
</span><a href="Unison.LSP.Types.html#%24sel%3AfileVersion%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">fileVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#FileVersion"><span class="hs-identifier hs-type">FileVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span id="%24sel%3AlexedSource%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; LexedSource
</span><a href="Unison.LSP.Types.html#%24sel%3AlexedSource%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">lexedSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#LexedSource"><span class="hs-identifier hs-type">LexedSource</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span id="%24sel%3AparsedFile%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Maybe (UnisonFile Symbol Ann)
</span><a href="Unison.LSP.Types.html#%24sel%3AparsedFile%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">parsedFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span id="%24sel%3AtypecheckedFile%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.LSP.Types.html#%24sel%3AtypecheckedFile%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">typecheckedFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span id="%24sel%3Anotes%3AFileAnalysis"><span class="annot"><span class="annottext">FileAnalysis -&gt; Seq (Note Symbol Ann)
</span><a href="Unison.LSP.Types.html#%24sel%3Anotes%3AFileAnalysis"><span class="hs-identifier hs-var hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679395189"><span id="local-6989586621679395191"><span id="local-6989586621679395193"><span class="annot"><span class="annottext">Int -&gt; FileAnalysis -&gt; ShowS
[FileAnalysis] -&gt; ShowS
FileAnalysis -&gt; String
(Int -&gt; FileAnalysis -&gt; ShowS)
-&gt; (FileAnalysis -&gt; String)
-&gt; ([FileAnalysis] -&gt; ShowS)
-&gt; Show FileAnalysis
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FileAnalysis] -&gt; ShowS
$cshowList :: [FileAnalysis] -&gt; ShowS
show :: FileAnalysis -&gt; String
$cshow :: FileAnalysis -&gt; String
showsPrec :: Int -&gt; FileAnalysis -&gt; ShowS
$cshowsPrec :: Int -&gt; FileAnalysis -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Unison.LSP.Types.html#getCurrentPath"><span class="hs-identifier hs-type">getCurrentPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span>
</span><span id="line-82"></span><span id="getCurrentPath"><span class="annot"><span class="annottext">getCurrentPath :: Lsp Absolute
</span><a href="Unison.LSP.Types.html#getCurrentPath"><span class="hs-identifier hs-var hs-var">getCurrentPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO Absolute) -&gt; Lsp (IO Absolute)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO Absolute
</span><a href="Unison.LSP.Types.html#%24sel%3AcurrentPathCache%3AEnv"><span class="hs-identifier hs-var hs-var">currentPathCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO Absolute) -&gt; (IO Absolute -&gt; Lsp Absolute) -&gt; Lsp Absolute
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO Absolute -&gt; Lsp Absolute
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Unison.LSP.Types.html#globalPPE"><span class="hs-identifier hs-type">globalPPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-85"></span><span id="globalPPE"><span class="annot"><span class="annottext">globalPPE :: Lsp PrettyPrintEnvDecl
</span><a href="Unison.LSP.Types.html#globalPPE"><span class="hs-identifier hs-var hs-var">globalPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO PrettyPrintEnvDecl) -&gt; Lsp (IO PrettyPrintEnvDecl)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO PrettyPrintEnvDecl
</span><a href="Unison.LSP.Types.html#%24sel%3AppeCache%3AEnv"><span class="hs-identifier hs-var hs-var">ppeCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO PrettyPrintEnvDecl)
-&gt; (IO PrettyPrintEnvDecl -&gt; Lsp PrettyPrintEnvDecl)
-&gt; Lsp PrettyPrintEnvDecl
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO PrettyPrintEnvDecl -&gt; Lsp PrettyPrintEnvDecl
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Unison.LSP.Types.html#getParseNames"><span class="hs-identifier hs-type">getParseNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span>
</span><span id="line-88"></span><span id="getParseNames"><span class="annot"><span class="annottext">getParseNames :: Lsp NamesWithHistory
</span><a href="Unison.LSP.Types.html#getParseNames"><span class="hs-identifier hs-var hs-var">getParseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; IO NamesWithHistory) -&gt; Lsp (IO NamesWithHistory)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO NamesWithHistory
</span><a href="Unison.LSP.Types.html#%24sel%3AparseNamesCache%3AEnv"><span class="hs-identifier hs-var hs-var">parseNamesCache</span></a></span><span> </span><span class="annot"><span class="annottext">Lsp (IO NamesWithHistory)
-&gt; (IO NamesWithHistory -&gt; Lsp NamesWithHistory)
-&gt; Lsp NamesWithHistory
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO NamesWithHistory -&gt; Lsp NamesWithHistory
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">data</span><span> </span><span id="Config"><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Config"><span class="annot"><a href="Unison.LSP.Types.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- | Lift a backend computation into the Lsp monad.</span><span>
</span><span id="line-93"></span><span id="local-6989586621679395181"><span class="annot"><a href="Unison.LSP.Types.html#lspBackend"><span class="hs-identifier hs-type">lspBackend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Backend.Backend</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679395181"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Backend.BackendError</span></span><span> </span><span class="annot"><a href="#local-6989586621679395181"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-94"></span><span id="lspBackend"><span class="annot"><span class="annottext">lspBackend :: Backend IO a -&gt; Lsp (Either BackendError a)
</span><a href="Unison.LSP.Types.html#lspBackend"><span class="hs-identifier hs-var hs-var">lspBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either BackendError a) -&gt; Lsp (Either BackendError a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either BackendError a) -&gt; Lsp (Either BackendError a))
-&gt; (Backend IO a -&gt; IO (Either BackendError a))
-&gt; Backend IO a
-&gt; Lsp (Either BackendError a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExceptT BackendError IO a -&gt; IO (Either BackendError a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT BackendError IO a -&gt; IO (Either BackendError a))
-&gt; (Backend IO a -&gt; ExceptT BackendError IO a)
-&gt; Backend IO a
-&gt; IO (Either BackendError a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ReaderT BackendEnv (ExceptT BackendError IO) a
 -&gt; BackendEnv -&gt; ExceptT BackendError IO a)
-&gt; BackendEnv
-&gt; ReaderT BackendEnv (ExceptT BackendError IO) a
-&gt; ExceptT BackendError IO a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">ReaderT BackendEnv (ExceptT BackendError IO) a
-&gt; BackendEnv -&gt; ExceptT BackendError IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; BackendEnv
</span><span class="hs-identifier hs-var">Backend.BackendEnv</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ReaderT BackendEnv (ExceptT BackendError IO) a
 -&gt; ExceptT BackendError IO a)
-&gt; (Backend IO a -&gt; ReaderT BackendEnv (ExceptT BackendError IO) a)
-&gt; Backend IO a
-&gt; ExceptT BackendError IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Backend IO a -&gt; ReaderT BackendEnv (ExceptT BackendError IO) a
forall (m :: * -&gt; *) a.
Backend m a -&gt; ReaderT BackendEnv (ExceptT BackendError m) a
</span><span class="hs-identifier hs-var hs-var">Backend.runBackend</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Unison.LSP.Types.html#sendNotification"><span class="hs-identifier hs-type">sendNotification</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679395172"><span class="annot"><a href="#local-6989586621679395172"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">FromServer</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Notification</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="annot"><a href="#local-6989586621679395172"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NotificationMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679395172"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NotificationMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679395172"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.LSP.Types.html#Lsp"><span class="hs-identifier hs-type">Lsp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="sendNotification"><span class="annot"><span class="annottext">sendNotification :: NotificationMessage m -&gt; Lsp ()
</span><a href="Unison.LSP.Types.html#sendNotification"><span class="hs-identifier hs-var hs-var">sendNotification</span></a></span></span><span> </span><span id="local-6989586621679395171"><span class="annot"><span class="annottext">NotificationMessage m
</span><a href="#local-6989586621679395171"><span class="hs-identifier hs-var">notif</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621679395170"><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621679395170"><span class="hs-identifier hs-var">sendServerMessage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Env -&gt; FromServerMessage -&gt; IO ())
-&gt; Lsp (FromServerMessage -&gt; IO ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LanguageContextEnv Config -&gt; FromServerMessage -&gt; IO ()
forall config.
LanguageContextEnv config -&gt; FromServerMessage -&gt; IO ()
</span><span class="hs-identifier hs-var hs-var">resSendMessage</span></span><span> </span><span class="annot"><span class="annottext">(LanguageContextEnv Config -&gt; FromServerMessage -&gt; IO ())
-&gt; (Env -&gt; LanguageContextEnv Config)
-&gt; Env
-&gt; FromServerMessage
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Env -&gt; LanguageContextEnv Config
</span><a href="Unison.LSP.Types.html#%24sel%3AlspContext%3AEnv"><span class="hs-identifier hs-var hs-var">lspContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; Lsp ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Lsp ()) -&gt; IO () -&gt; Lsp ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FromServerMessage -&gt; IO ()
</span><a href="#local-6989586621679395170"><span class="hs-identifier hs-var">sendServerMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; IO ()) -&gt; FromServerMessage -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SMethod m -&gt; Message m -&gt; FromServerMessage
forall (t :: MethodType) (m :: Method 'FromServer t)
       (a :: Method 'FromClient 'Request -&gt; *).
SMethod m -&gt; Message m -&gt; FromServerMessage' a
</span><span class="hs-identifier hs-var">FromServerMess</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotificationMessage m
</span><a href="#local-6989586621679395171"><span class="hs-identifier hs-var">notif</span></a></span><span> </span><span class="annot"><span class="annottext">NotificationMessage m
-&gt; Getting (SMethod m) (NotificationMessage m) (SMethod m)
-&gt; SMethod m
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (SMethod m) (NotificationMessage m) (SMethod m)
forall s a. HasMethod s a =&gt; Lens' s a
</span><span class="hs-identifier hs-var">method</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message m
NotificationMessage m
</span><a href="#local-6989586621679395171"><span class="hs-identifier hs-var">notif</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span></pre></body></html>